import{j as e}from"./spline-OfIZ-5GP.js";import{r}from"./react-vendor-ClpDbY_3.js";import{s,S as t,a}from"./index-BeWpAAxC.js";import{u as l,c as o}from"./ToggleSwitch-DHZiuePx.js";import{c as n}from"./createLucideIcon-DkpiXdJH.js";import{C as i}from"./check-Bt1Gg7zJ.js";import{L as c}from"./AccountTypeSection-DTvLxAR6.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d=n("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),m={artist:"/learn/artist",freelancer:"/learn/freelancer",business:"/learn/brands",creator:"/"};function x({userType:n,userId:x}){var p;const{t:u}=l(),[y,f]=r.useState(null),[h,v]=r.useState(""),[b,g]=r.useState(!1),[j,N]=r.useState(!1),[w,C]=r.useState(!0),[k,S]=r.useState(!1),[_,T]=r.useState(null),[A,E]=r.useState(!1);r.useEffect(()=>{B()},[]);const B=async()=>{try{let l=null;try{const{data:{user:e}}=await s.auth.getUser();l=(null==e?void 0:e.id)||null}catch(e){}const o=localStorage.getItem("verifiedUserId"),n=x||l||o;if(!n)return void C(!1);let i=null;try{const e=`${t}/functions/v1/get-profile?userId=${n}`,r=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(r.ok){const e=await r.json();e.success&&e.profile&&(i=e.profile.username)}}catch(r){}if(!i){const{data:e}=await s.from("users").select("username").eq("id",n).maybeSingle();if(i=null==e?void 0:e.username,!i){const{data:e}=await s.from("profiles").select("name").eq("id",n).maybeSingle();(null==e?void 0:e.name)&&(i=e.name.replace(/\s+/g,""))}}if(i){const{data:e}=await s.from("referral_codes").select("total_uses, total_earnings").eq("user_id",n).maybeSingle();f({code:i.toUpperCase(),total_uses:(null==e?void 0:e.total_uses)||0,total_earnings:(null==e?void 0:e.total_earnings)||0})}const{data:c}=await s.from("referral_applications").select("id").eq("user_id",n).maybeSingle();E(!!c)}catch(l){}finally{C(!1)}},F=()=>{if(!y)return"";return`${window.location.origin}${m[n||"creator"]??"/"}?ref=${y.code}`};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5",children:[e.jsxs("div",{className:"rounded-xl sm:rounded-2xl p-5 sm:p-7 border",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(d,{className:"w-5 h-5",style:{color:"var(--text-primary)"}}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold",style:{color:"var(--text-primary)"},children:u("referral.yourCode")})]}),e.jsx("div",{className:"rounded-lg p-4 mb-5",style:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--text-primary)"},children:u("referral.yourReferralCode")}),e.jsx("div",{className:"h-[60px] flex items-center justify-center mb-3",children:e.jsx("div",{className:"text-2xl sm:text-3xl font-bold tracking-wider",style:{color:"var(--text-primary)"},children:(null==y?void 0:y.code)||"N/A"})}),e.jsx("button",{onClick:async()=>{if(y)try{await navigator.clipboard.writeText(y.code),g(!0),setTimeout(()=>g(!1),2e3)}catch(e){}},disabled:!y,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--text-primary)",color:"var(--bg-primary)"},children:b?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:u("referral.copied")})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{children:u("referral.copyCode")})]})})]})}),y&&e.jsxs("div",{className:"mb-5",children:[e.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--text-primary)"},children:"YOUR REFERRAL LINK"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg",style:{backgroundColor:"var(--bg-elevated)",border:"1px solid var(--border-subtle)"},children:[e.jsx(c,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:"var(--text-primary)"}}),e.jsx("span",{className:"text-xs truncate flex-1",style:{color:"var(--text-primary)"},children:F()}),e.jsxs("button",{onClick:async()=>{try{await navigator.clipboard.writeText(F()),N(!0),setTimeout(()=>N(!1),2e3)}catch(e){}},className:"flex items-center gap-1.5 text-xs font-medium px-2.5 py-1 rounded-full flex-shrink-0 transition-all hover:opacity-80",style:{color:"var(--bg-primary)",backgroundColor:"var(--text-primary)"},children:[j?e.jsx(i,{className:"w-3 h-3"}):e.jsx(o,{className:"w-3 h-3"}),j?"Copied":"Copy"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-3",style:{color:"var(--text-primary)"},children:u("referral.yourStats")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-3 rounded-lg",style:{backgroundColor:"transparent"},children:[e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:u("referral.totalUses")}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:(null==y?void 0:y.total_uses)||0})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-3 rounded-lg",style:{backgroundColor:"transparent"},children:[e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:u("referral.totalEarned")}),e.jsxs("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:["$",(null==(p=null==y?void 0:y.total_earnings)?void 0:p.toFixed(2))||"0.00"]})]})]})]})]}),e.jsxs("div",{className:"rounded-xl sm:rounded-2xl p-5 sm:p-7 border",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(d,{className:"w-5 h-5",style:{color:"var(--text-primary)"}}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold",style:{color:"var(--text-primary)"},children:u("referral.enterACode")})]}),A?e.jsxs("div",{className:"rounded-lg p-6 text-center",style:{backgroundColor:"transparent"},children:[e.jsx(i,{className:"w-12 h-12 mx-auto mb-3",style:{color:"#10B981"}}),e.jsx("p",{className:"text-base font-medium mb-1",style:{color:"var(--text-primary)"},children:u("referral.codeApplied")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:u("referral.alreadyApplied")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg p-4 mb-5",style:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-xs font-medium mb-2",style:{color:"var(--text-primary)"},children:u("referral.referralCode")}),e.jsx("div",{className:"h-[60px] flex items-center justify-center mb-3",children:e.jsx("input",{type:"text",value:h,onChange:e=>v(e.target.value.toUpperCase()),placeholder:u("referral.enterCode"),maxLength:8,className:"w-full px-4 py-2.5 rounded-lg text-2xl sm:text-3xl font-bold tracking-wider text-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/20",style:{backgroundColor:"transparent",color:"var(--text-primary)"}})}),e.jsx("button",{onClick:async()=>{if(h.trim()&&!k){S(!0),T(null);try{const{data:e,error:r}=await s.rpc("apply_referral_code",{p_code:h.trim().toUpperCase()});if(r)throw r;e.success?(T({type:"success",text:e.message}),v(""),E(!0)):T({type:"error",text:e.error})}catch(e){T({type:"error",text:e.message||u("referral.failedToApply")})}finally{S(!1)}}},disabled:!h.trim()||k,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--text-primary)",color:"var(--bg-primary)"},children:u(k?"referral.applying":"referral.applyCode")})]})}),_&&e.jsx("div",{className:"rounded-lg p-3 text-sm text-center mb-5",style:{backgroundColor:"success"===_.type?"#10B98120":"#EF444420",color:"success"===_.type?"#10B981":"#EF4444"},children:_.text}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-3",style:{color:"var(--text-primary)"},children:u("referral.benefits")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-3 rounded-lg",style:{backgroundColor:"transparent"},children:[e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:u("referral.firstCampaignBonus")}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{backgroundColor:"#10B981"}})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-3 rounded-lg",style:{backgroundColor:"transparent"},children:[e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:u("referral.supportCommunity")}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{backgroundColor:"#10B981"}})]})]})]})]})]})]})}export{x as R};

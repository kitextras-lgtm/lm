import{c as e}from"./createLucideIcon-DApH4y_Q.js";import{j as t}from"./spline-DN92G9fQ.js";import{r as s}from"./react-vendor-C5CBPnGl.js";import{u as n,s as r,p as a,g as i}from"./index-DHN5MaPw.js";import{A as o}from"./arrow-left-D6ZoFILw.js";import{C as l}from"./chevron-down-BtUUkoj_.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c=e("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),d=e("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),u=e("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),m=e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),x=e("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),g=e("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),h=e("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),p=e("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),y=e("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),f=e("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),v=e("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),b=e("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),w=e("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),j=e("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_=e("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),k=`data:image/svg+xml;base64,${btoa('<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="avatarGradient" x1="0%" y1="0%" x2="100%" y2="100%">\n        <stop offset="0%" stop-color="#1e1e24"/>\n        <stop offset="100%" stop-color="#0f0f13"/>\n      </linearGradient>\n      <linearGradient id="avatarShine" x1="0%" y1="0%" x2="100%" y2="100%">\n        <stop offset="0%" stop-color="#64748B" stop-opacity="0.15"/>\n        <stop offset="100%" stop-color="#64748B" stop-opacity="0"/>\n      </linearGradient>\n    </defs>\n    <circle cx="20" cy="20" r="20" fill="url(#avatarGradient)"/>\n    <circle cx="20" cy="15" r="7" fill="#64748B" fill-opacity="0.8"/>\n    <path d="M8 32c0-5.523 4.477-10 10-10h4c5.523 0 10 4.477 10 10" stroke="#64748B" stroke-width="2.5" stroke-opacity="0.8" fill="none" stroke-linecap="round"/>\n    <circle cx="20" cy="20" r="20" fill="url(#avatarShine)"/>\n  </svg>')}`;
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */btoa('<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect width="40" height="40" fill="#000000"/>\n    <g>\n      \x3c!-- Leftmost bar (shortest) --\x3e\n      <rect x="7" y="19" width="3" height="6" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Second bar (medium) --\x3e\n      <rect x="12" y="16" width="3" height="12" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Center bar (tallest) --\x3e\n      <rect x="17" y="8" width="3" height="24" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Fourth bar (medium) --\x3e\n      <rect x="22" y="16" width="3" height="12" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Rightmost bar (shortest) --\x3e\n      <rect x="27" y="19" width="3" height="6" rx="1.5" fill="#FFFFFF"/>\n    </g>\n  </svg>');const N="https://hlcpoqxzqgbghsadouef.supabase.co/storage/v1/object/public/avatars/pic/elevate%20solid%20white%20logo%20ver.jpeg";function C({className:e,style:n,backgroundTheme:r}){const[a,i]=s.useState(!1);return t.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:n,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:t.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[t.jsx("rect",{x:"4",y:"14",width:"28",height:"20",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:a?"scale(1.05)":"scale(1)",transformOrigin:"18px 24px",transition:"transform 0.3s ease"}}),t.jsx("circle",{cx:"18",cy:"24",r:"6",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:a?"scale(1.1)":"scale(1)",transformOrigin:"18px 24px",transition:"transform 0.3s ease 0.05s"}}),t.jsx("circle",{cx:"18",cy:"24",r:"3",fill:"white",style:{opacity:a?.8:.4,transition:"opacity 0.3s ease"}}),t.jsx("circle",{cx:"16",cy:"22",r:"1",fill:"white",style:{opacity:a?.6:.2,transition:"opacity 0.3s ease 0.1s"}}),t.jsx("path",{d:"M32 18L44 12V36L32 30V18Z",stroke:"white",strokeWidth:"3",strokeLinejoin:"round",fill:"none",style:{transform:a?"translateX(2px) scale(1.1)":"translateX(0) scale(1)",transformOrigin:"32px 24px",transition:"transform 0.3s ease"}}),t.jsx("circle",{cx:"8",cy:"18",r:"2",fill:"#ef4444",style:{opacity:a?1:0,transform:a?"scale(1)":"scale(0)",transformOrigin:"8px 18px",transition:"all 0.3s ease"}}),t.jsx("circle",{cx:"8",cy:"18",r:"2",fill:"#ef4444",style:{opacity:a?.3:0,transform:a?"scale(2.5)":"scale(0)",transformOrigin:"8px 18px",transition:"all 0.5s ease"}})]})})}function S({className:e,style:n}){const[r,a]=s.useState(!1);return t.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:n,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:t.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[t.jsx("rect",{x:"6",y:"10",width:"36",height:"32",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:r?"scale(1.05)":"scale(1)",transformOrigin:"24px 26px",transition:"transform 0.3s ease"}}),t.jsx("line",{x1:"6",y1:"18",x2:"42",y2:"18",stroke:"white",strokeWidth:"3",style:{opacity:r?.8:.6,transition:"opacity 0.3s ease"}}),t.jsx("line",{x1:"14",y1:"6",x2:"14",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{transform:r?"translateY(-1px)":"translateY(0)",transition:"transform 0.3s ease"}}),t.jsx("line",{x1:"34",y1:"6",x2:"34",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{transform:r?"translateY(-1px)":"translateY(0)",transition:"transform 0.3s ease 0.05s"}}),t.jsx("circle",{cx:"12",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.1s"}}),t.jsx("circle",{cx:"18",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.15s"}}),t.jsx("circle",{cx:"24",cy:"24",r:"1.5",fill:"white",style:{opacity:r?1:.4,transition:"opacity 0.3s ease 0.2s"}}),t.jsx("circle",{cx:"30",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.25s"}}),t.jsx("circle",{cx:"36",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.3s"}}),t.jsx("circle",{cx:"12",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.35s"}}),t.jsx("circle",{cx:"18",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.4s"}}),t.jsx("circle",{cx:"24",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.45s"}}),t.jsx("circle",{cx:"30",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.5s"}}),t.jsx("circle",{cx:"36",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.55s"}}),t.jsx("circle",{cx:"12",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.6s"}}),t.jsx("circle",{cx:"18",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.65s"}}),t.jsx("circle",{cx:"24",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.7s"}}),t.jsx("circle",{cx:"30",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.75s"}}),t.jsx("circle",{cx:"36",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.8s"}}),t.jsx("rect",{x:"8",y:"20",width:"32",height:"22",fill:"rgba(255,255,255,0.05)",style:{opacity:r?1:0,transition:"opacity 0.3s ease"}})]})})}function F({className:e,style:n,isDrawerOpen:r,backgroundTheme:a}){const[i,o]=s.useState(!1);return t.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:n,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:t.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[t.jsx("rect",{x:"6",y:"6",width:"36",height:"36",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:i?"scale(1.02)":"scale(1)",transformOrigin:"24px 24px",transition:"transform 0.3s ease"}}),t.jsx("rect",{x:"10",y:"10",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"none",style:{opacity:.6}}),t.jsx("line",{x1:"20",y1:"14",x2:"28",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{opacity:.6}}),t.jsxs("g",{style:{transform:i||r?"translateY(12px) scale(1.05)":"translateY(0) scale(1)",transformOrigin:"24px 24px",transition:"transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:[t.jsx("rect",{x:"10",y:"20",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"light"===a?"rgba(15, 23, 42, 0.9)":"rgba(0,0,0,0.9)"}),t.jsx("line",{x1:"20",y1:"24",x2:"28",y2:"24",stroke:"white",strokeWidth:"3",strokeLinecap:"round"}),t.jsxs("g",{style:{opacity:i||r?1:0,transition:"opacity 0.3s ease 0.15s"},children:[t.jsx("rect",{x:"12",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.7"}),t.jsx("rect",{x:"17",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.5"}),t.jsx("rect",{x:"22",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.6"}),t.jsx("line",{x1:"13",y1:"23.5",x2:"15",y2:"23.5",stroke:"light"===a?"rgba(148, 163, 184, 0.5)":"rgba(0,0,0,0.5)",strokeWidth:"0.5"}),t.jsx("line",{x1:"18",y1:"23.5",x2:"20",y2:"23.5",stroke:"light"===a?"rgba(148, 163, 184, 0.5)":"rgba(0,0,0,0.5)",strokeWidth:"0.5"}),t.jsx("line",{x1:"23",y1:"23.5",x2:"25",y2:"23.5",stroke:"light"===a?"rgba(148, 163, 184, 0.5)":"rgba(0,0,0,0.5)",strokeWidth:"0.5"})]})]}),t.jsx("rect",{x:"10",y:"30",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"none",style:{opacity:.6}}),t.jsx("line",{x1:"20",y1:"34",x2:"28",y2:"34",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{opacity:.6}}),t.jsx("rect",{x:"10",y:"28",width:"28",height:"4",fill:"white",style:{opacity:i?.2:0,transition:"opacity 0.3s ease"}}),t.jsx("rect",{x:"20",y:"8",width:"8",height:"2",rx:"1",fill:"white",style:{opacity:i?.8:.4,transition:"opacity 0.3s ease"}})]})})}function T({user:e,isTyping:s,onBack:r,showBackButton:a,onVideoCall:i,onScheduleMeeting:l,onOpenDrawer:c,isDrawerOpen:d,backgroundTheme:u="dark"}){const{profile:m}=n(),x=m&&"artist"!==m.user_type;return t.jsxs("div",{className:"h-14 lg:h-16 px-3 lg:px-4 flex items-center justify-between min-w-0",style:{borderBottom:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"light"===u?"#0F172A":"grey"===u?"#1A1A1E":"#000000"},children:[t.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 min-w-0 flex-1",children:[a&&t.jsx("button",{onClick:r,className:"p-1.5 lg:p-2 -ml-1 lg:-ml-2 rounded-full hover:brightness-110 transition-colors lg:hidden",style:{color:"light"===u?"#64748B":"#94A3B8"},children:t.jsx(o,{className:"w-4 h-4 lg:w-5 lg:h-5"})}),t.jsx("div",{className:"relative flex-shrink-0",children:t.jsx("img",{src:e.is_admin?N:e.avatar_url||k,alt:e.name,className:"w-8 h-8 lg:w-10 lg:h-10 rounded-full object-cover default-avatar-shake",style:{backgroundColor:"#0f0f13"}})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h2",{className:"text-sm lg:text-base font-medium truncate",style:{color:"light"===u?"#FFFFFF":"#F8FAFC"},children:e.name}),s&&t.jsx("p",{className:"text-[10px] lg:text-xs",style:{color:"light"===u?"#64748B":"#94A3B8"},children:"typing..."})]})]}),x&&t.jsxs("div",{className:"flex items-center gap-1 lg:gap-2",children:[t.jsx("button",{onClick:i,className:"p-2.5 rounded-lg transition-colors","aria-label":"Video call",children:t.jsx(C,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"},backgroundTheme:u})}),t.jsx("button",{onClick:l,className:"p-2.5 rounded-lg transition-colors","aria-label":"Schedule meeting",children:t.jsx(S,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"}})}),t.jsx("button",{onClick:c,className:"p-2.5 rounded-lg transition-colors","aria-label":"View details",children:t.jsx(F,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"},isDrawerOpen:d,backgroundTheme:u})})]})]})}function E({file:e,onRemove:n}){const[r,a]=s.useState("");return s.useEffect(()=>{const t=URL.createObjectURL(e);return a(t),()=>{URL.revokeObjectURL(t)}},[e]),t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:r,alt:"Upload preview",className:"w-20 h-20 object-cover rounded-lg",style:{border:"1px solid rgba(75, 85, 99, 0.2)"}}),t.jsx("button",{onClick:n,className:"absolute -top-2 -right-2 p-1 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:t.jsx(_,{className:"w-3.5 h-3.5",style:{color:"#F8FAFC"}})})]})}function M({replyTo:e,onCancel:s}){const n=e.content.length>80?e.content.substring(0,80)+"...":e.content;return t.jsx("div",{className:"animate-fade-in",children:t.jsxs("div",{className:"flex items-start gap-3 px-3 py-2 rounded-lg border-l-2",style:{backgroundColor:"#1a1a1e",borderColor:"#64748B"},children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-xs font-medium",style:{color:"#F8FAFC"},children:["Replying to ",e.senderName]}),t.jsx("p",{className:"text-xs truncate mt-0.5",style:{color:"#94A3B8"},children:n||"Image"})]}),t.jsx("button",{onClick:s,className:"shrink-0 p-1 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(_,{className:"w-4 h-4"})})]})})}const I=10485760,D=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];function L({onSendMessage:e,onTyping:n,disabled:r,replyTo:a,onCancelReply:i,otherUserName:o,conversationId:l,initialDraft:d="",onDraftChange:u,onDraftClear:m}){const[x,g]=s.useState(d),[p,y]=s.useState(null),f=s.useRef(null),v=s.useRef(null),b=s.useRef(null),j=s.useRef(null),_=s.useRef(null),k=s.useRef(null);s.useEffect(()=>{g(d)},[l,d]),s.useEffect(()=>{const e=v.current;if(e){e.style.height="36px";const t=e.scrollHeight;t>36&&(e.style.height=`${Math.min(t,150)}px`)}},[x]),s.useEffect(()=>{a&&v.current&&v.current.focus()},[a]),s.useEffect(()=>{b.current&&(b.current.style.borderRadius="0"),j.current&&(j.current.style.borderRadius="0"),v.current&&(v.current.style.borderRadius="0")},[]);const N=s.useCallback(e=>{l&&u&&(k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{u(l,e)},500))},[l,u]),C=()=>{!x.trim()&&!p||r||(e(x.trim(),p||void 0,a||void 0),g(""),y(null),n(!1),_.current&&clearTimeout(_.current),l&&m&&m(l))},S=s.useCallback(e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&D.includes(s.type)?(s.size>I||y(s),e.target.value=""):e.target.value=""},[]),F=x.trim()||p;return t.jsxs(t.Fragment,{children:[a&&i&&t.jsx("div",{className:"px-3 lg:px-4 pt-3",children:t.jsx(M,{replyTo:a,onCancel:i})}),p&&t.jsx("div",{className:"px-3 lg:px-4 py-2",children:t.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-3",style:{backgroundColor:"rgba(26, 26, 30, 0.5)"},children:[t.jsx(E,{file:p,onRemove:()=>y(null)}),p.size>I&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"#ef4444"},children:[t.jsx(c,{className:"w-4 h-4"}),t.jsx("span",{children:"File too large"})]})]})}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),C()},className:"flex gap-2 items-center safe-area-inset-bottom",style:{borderTop:"1px solid var(--border-default)",backgroundColor:"var(--bg-sidebar)",padding:"12px 16px"},children:[t.jsx("input",{type:"file",ref:f,onChange:S,accept:"image/*",className:"hidden"}),t.jsx("button",{ref:b,type:"button",onClick:()=>{var e;return null==(e=f.current)?void 0:e.click()},disabled:r,className:"shrink-0 hover:bg-transparent group h-8 w-8 flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"var(--text-secondary)",borderRadius:0,border:"1px solid var(--border-default)"},children:t.jsx(h,{className:"w-4 h-4 transition-transform duration-200 group-hover:scale-125"})}),t.jsx("textarea",{ref:v,value:x,onChange:e=>{g(e.target.value),n(!0),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{n(!1)},2e3),N(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:o?`Message @${o}`:"Send a message...",disabled:r,rows:1,maxLength:5e3,"aria-label":"Message input",className:"flex-1 px-4 py-2 text-sm focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed resize-none overflow-y-auto",style:{minHeight:"32px",maxHeight:"120px",color:"var(--text-primary)",backgroundColor:"var(--bg-input)",border:"1px solid var(--border-default)",borderRadius:0,opacity:.7}}),t.jsx("button",{ref:j,type:"submit",disabled:!F||r,className:"shrink-0 h-8 w-8 flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed",style:F?{backgroundColor:"#F8FAFC",color:"#111111",borderRadius:0,border:"1px solid var(--border-default)"}:{backgroundColor:"rgba(148, 163, 184, 0.1)",color:"var(--text-secondary)",borderRadius:0,border:"1px solid var(--border-default)"},children:t.jsx(w,{className:"w-4 h-4"})})]})]})}function B({isOpen:e,onClose:n,imageUrl:r}){return s.useEffect(()=>{const t=e=>{"Escape"===e.key&&n()};return e&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[e,n]),e?t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm animate-fade-in",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:n,children:[t.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[t.jsx("a",{href:r,download:!0,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},onClick:e=>e.stopPropagation(),children:t.jsx(x,{className:"w-5 h-5"})}),t.jsx("button",{onClick:n,className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:t.jsx(_,{className:"w-5 h-5"})})]}),t.jsx("img",{src:r,alt:"Full size preview",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg",onClick:e=>e.stopPropagation()})]}):null}function R(e){const t=new Date(e),s=new Date,n=s.getTime()-t.getTime(),r=Math.floor(n/864e5);return 0===r?"Today":1===r?"Yesterday":r<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==s.getFullYear()?"numeric":void 0})}function q(e){const t=new Date(e),s=(new Date).getTime()-t.getTime(),n=Math.floor(s/864e5);return 0===n?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):1===n?"Yesterday":n<7?t.toLocaleDateString("en-US",{weekday:"short"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const O=s.memo(function(){return s.useEffect(()=>{if(!document.getElementById("wave-hand-keyframes")){const e=document.createElement("style");e.id="wave-hand-keyframes",e.textContent="\n        @keyframes wave-hand {\n          0%, 100% {\n            transform: rotate(0deg);\n          }\n          10%, 30% {\n            transform: rotate(14deg);\n          }\n          20% {\n            transform: rotate(-8deg);\n          }\n          40%, 60% {\n            transform: rotate(0deg);\n          }\n          50% {\n            transform: rotate(10deg);\n          }\n          70% {\n            transform: rotate(0deg);\n          }\n          80% {\n            transform: rotate(-5deg);\n          }\n          90% {\n            transform: rotate(0deg);\n          }\n        }\n      ",document.head.appendChild(e)}},[]),t.jsx("span",{className:"inline-block",style:{display:"inline-block",transformOrigin:"70% 70%",animation:"wave-hand 1s ease-in-out infinite"},children:"üëã"})}),U=s.memo(function({message:e,isOwn:n,onReply:r,onScrollToMessage:a,senderName:i,onImageLoad:o,onDelete:l}){const[c,d]=s.useState(!1),[u,x]=s.useState(!1),[g,h]=s.useState(!1),[p,y]=s.useState(!1),[f,b]=s.useState(!1);s.useEffect(()=>{if("image"===e.type&&e.image_url){const t=new Image;t.onload=()=>{b(!0),null==o||o(e.id,!0)},t.onerror=()=>{y(!0),null==o||o(e.id,!0)},t.src=e.image_url}else null==o||o(e.id,!0)},[e.id,e.type,e.image_url,o]);const w=e.reply_to_id&&(e.reply_to_sender_name||e.reply_to_content);return e.deleted_at?t.jsx("div",{className:`flex ${n?"justify-end":"justify-start"} px-2 lg:px-4 py-0.5`,children:t.jsx("div",{className:"px-3 py-2 rounded-lg bg-gray-800/50 text-gray-500 italic text-sm",children:"This message was deleted"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{id:`message-${e.id}`,className:`group flex ${n?"justify-end":"justify-start"} px-2 lg:px-4 py-0.5`,onMouseEnter:()=>d(!0),onMouseLeave:()=>{d(!1),x(!1)},children:t.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%] min-w-0 "+(n?"flex-row-reverse":"flex-row"),children:[t.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[w&&t.jsxs("button",{onClick:()=>{e.reply_to_id&&a&&a(e.reply_to_id)},className:"text-left px-2 py-1.5 rounded-lg border-l-2 transition-colors "+(n?"ml-auto":"mr-auto"),style:{backgroundColor:"#1a1a1e",borderColor:"#64748B",color:"#F8FAFC"},children:[t.jsx("p",{className:"text-[10px] font-medium",style:{color:"#64748B"},children:e.reply_to_sender_name}),t.jsx("p",{className:"text-[10px] line-clamp-1",style:{color:"#94A3B8"},children:e.reply_to_content||"Image"})]}),t.jsxs("div",{className:"relative rounded-2xl overflow-hidden transition-all duration-200 min-w-0 "+("image"!==e.type||e.content?"":"p-0"),style:n?{backgroundColor:"#F8FAFC",color:"#111111"}:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:["image"===e.type&&e.image_url&&t.jsx("div",{className:"relative "+(e.content?"px-4 pt-3":"p-0"),children:p?t.jsx("div",{className:"rounded-lg flex items-center justify-center "+(e.content?"mb-2":""),style:{width:"100%",maxWidth:"280px",height:"200px",backgroundColor:"#0f0f13"},children:t.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:"Failed to load image"})}):t.jsxs(t.Fragment,{children:[!f&&t.jsx("div",{className:"chat-image-placeholder rounded-lg "+(e.content?"mb-2":""),style:{width:"280px",height:"200px",backgroundColor:"rgba(75, 85, 99, 0.15)"}}),t.jsx("img",{src:e.image_url,alt:"Shared image",className:`rounded-lg w-full max-w-[280px] lg:max-w-[280px] max-h-[300px] object-cover cursor-pointer hover:opacity-90 transition-opacity ${e.content?"mb-2":""} ${f?"chat-image-loaded":""}`,style:{display:f?"block":"none",border:"none",outline:"none"},onClick:()=>h(!0),onError:()=>y(!0),onLoad:()=>b(!0)})]})}),e.content&&t.jsx("div",{className:"flex items-center min-h-[1.5rem] "+("image"===e.type&&e.image_url?"px-4 pb-3":"px-4 py-3"),children:t.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words w-full",children:e.content.split("üëã").map((e,s,n)=>s<n.length-1?t.jsxs("span",{children:[e,t.jsx(O,{})]},s):t.jsx("span",{children:e},s))})})]}),t.jsx("span",{className:"text-[10px] px-1 "+(n?"text-right":"text-left"),style:{color:"#94A3B8"},children:(_=e.created_at,new Date(_).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))})]}),t.jsxs("div",{className:"flex items-center gap-1 transition-opacity duration-200 "+(c?"opacity-100":"opacity-0"),children:[e.content&&t.jsx("button",{onClick:async()=>{if(e.content)try{await navigator.clipboard.writeText(e.content)}catch(t){}},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(m,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>{r&&r({id:e.id,senderName:i||"Unknown",content:e.content||("image"===e.type?"Image":"")})},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(v,{className:"w-3.5 h-3.5"})}),n&&t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>x(!u),className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(j,{className:"w-3.5 h-3.5"})}),u&&t.jsxs("div",{className:"absolute bottom-full right-0 mb-1 bg-gray-900 rounded-lg shadow-lg py-1 min-w-[140px] z-50",children:[t.jsx("button",{onClick:()=>{(async()=>{l&&l(e.id,!1)})(),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-white hover:bg-gray-800",children:"Delete for me"}),t.jsx("button",{onClick:()=>{(async()=>{l&&l(e.id,!0)})(),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-gray-800",children:"Delete for everyone"})]})]})]})]})}),"image"===e.type&&e.image_url&&t.jsx(B,{isOpen:g,onClose:()=>h(!1),imageUrl:e.image_url})]});var _});function A(){return t.jsx("div",{className:"flex items-center gap-1 px-4 py-2",children:t.jsxs("div",{className:"flex items-center gap-1 rounded-2xl px-4 py-3",style:{backgroundColor:"#1a1a1e"},children:[t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"0ms"}}),t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"150ms"}}),t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"300ms"}})]})})}function $({title:e,isOpen:s,onToggle:n,children:r}){return t.jsxs("div",{style:{borderBottom:"1px solid var(--border-subtle)"},children:[t.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between px-4 py-3 hover:bg-white/5 transition-colors",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:e}),s?t.jsx(l,{className:"w-4 h-4",style:{color:"var(--text-secondary)"}}):t.jsx(u,{className:"w-4 h-4",style:{color:"var(--text-secondary)"}})]}),t.jsx("div",{className:"overflow-hidden transition-all duration-300 ease-in-out",style:{maxHeight:s?"500px":"0"},children:t.jsx("div",{className:"px-4 pb-4",children:r})})]})}function z({isOpen:e,onClose:n,user:r,activities:a=[],meetings:i=[],files:o=[],participants:l=[],onSearchMessages:c}){const[u,m]=s.useState({activity:!1,search:!1,meetings:!1,people:!1,files:!1,notes:!1}),[h,y]=s.useState(""),[f,v]=s.useState(""),w=s.useRef(null);s.useEffect(()=>{const t=e=>{"Escape"===e.key&&n()};return e&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[e,n]),s.useEffect(()=>{const e=localStorage.getItem(`chat_notes_${r.id}`);e&&v(e)},[r.id]);const j=e=>{m(t=>({...t,[e]:!t[e]}))},C=a.length>0?a:[{id:"1",type:"contract",title:"Contract signed",date:"2024-01-15"},{id:"2",type:"milestone",title:"First deliverable completed",date:"2024-01-20"},{id:"3",type:"payment",title:"Payment received",description:"$500",date:"2024-01-25"}],S=i.length>0?i:[{id:"1",title:"Kickoff call",date:"2024-01-10",summary:"Discussed project scope and timeline"},{id:"2",title:"Progress review",date:"2024-01-18",summary:"Reviewed first draft, minor revisions needed"}],F=o.length>0?o:[{id:"1",name:"Contract.pdf",type:"file",size:"245 KB",url:"#",date:"2024-01-15"},{id:"2",name:"Brand Guidelines",type:"link",url:"#",date:"2024-01-12"}],T=l.length>0?l:[{id:r.id,name:r.name,avatar_url:r.avatar_url,role:"Creator"}];return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 transition-opacity duration-300 "+(e?"opacity-100":"opacity-0 pointer-events-none"),onClick:n}),t.jsx("div",{className:"fixed top-0 right-0 z-50 h-full w-full sm:w-[360px] transform transition-transform duration-300 ease-in-out "+(e?"translate-x-0":"translate-x-full"),style:{backgroundColor:"var(--bg-primary)"},children:t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-4",style:{borderBottom:"1px solid var(--border-subtle)"},children:[t.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"Details"}),t.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:bg-white/5 transition-colors","aria-label":"Close",children:t.jsx(_,{className:"w-5 h-5",style:{color:"var(--text-secondary)"}})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.3) transparent"},children:[t.jsxs("div",{className:"px-4 py-6 text-center",style:{borderBottom:"1px solid var(--border-subtle)"},children:[t.jsx("img",{src:r.is_admin?N:r.avatar_url||k,alt:r.name,className:"w-20 h-20 rounded-full object-cover mx-auto mb-3",style:{backgroundColor:"var(--bg-elevated)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:"var(--text-primary)"},children:r.name}),t.jsx("p",{className:"text-sm mb-1",style:{color:"var(--text-secondary)"},children:"Creator"}),t.jsx("p",{className:"text-xs mb-4",style:{color:"var(--text-secondary)"},children:"PST (UTC-8)"}),t.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-white/10",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#3B82F6",border:"1px solid rgba(59, 130, 246, 0.3)"},children:"View Contract"})]}),t.jsx($,{title:"Activity Timeline",isOpen:u.activity,onToggle:()=>j("activity"),children:t.jsx("div",{className:"space-y-3",children:C.map((e,s)=>t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:"payment"===e.type?"#22C55E":"milestone"===e.type?"#3B82F6":"#64748B"}}),s<C.length-1&&t.jsx("div",{className:"w-0.5 flex-1 mt-1",style:{backgroundColor:"var(--border-subtle)"}})]}),t.jsxs("div",{className:"flex-1 pb-3",children:[t.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:e.title}),e.description&&t.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:e.description}),t.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:e.date})]})]},e.id))})}),t.jsx($,{title:"Search Messages",isOpen:u.search,onToggle:()=>j("search"),children:t.jsxs("div",{className:"relative",children:[t.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"var(--text-secondary)"}}),t.jsx("input",{type:"text",value:h,onChange:e=>y(e.target.value),onKeyDown:e=>"Enter"===e.key&&void(c&&h.trim()&&c(h)),placeholder:"Search in conversation...",className:"w-full pl-10 pr-4 py-2.5 rounded-lg text-sm focus:outline-none focus:ring-1",style:{backgroundColor:"var(--bg-elevated)",border:"1px solid var(--border-subtle)",color:"var(--text-primary)"}})]})}),t.jsx($,{title:"Meeting Recaps",isOpen:u.meetings,onToggle:()=>j("meetings"),children:t.jsx("div",{className:"space-y-3",children:S.map(e=>t.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--bg-elevated)"},children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(d,{className:"w-3.5 h-3.5",style:{color:"var(--text-secondary)"}}),t.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:e.date})]}),t.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--text-primary)"},children:e.title}),e.summary&&t.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:e.summary})]},e.id))})}),t.jsx($,{title:"People",isOpen:u.people,onToggle:()=>j("people"),children:t.jsx("div",{className:"space-y-2",children:T.map(e=>t.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors",children:[t.jsx("img",{src:e.avatar_url||k,alt:e.name,className:"w-9 h-9 rounded-full object-cover",style:{backgroundColor:"var(--bg-elevated)"}}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:e.name}),e.role&&t.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:e.role})]})]},e.id))})}),t.jsx($,{title:"Files and Links",isOpen:u.files,onToggle:()=>j("files"),children:t.jsx("div",{className:"space-y-2",children:F.map(e=>t.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors",children:["file"===e.type?t.jsx(g,{className:"w-5 h-5",style:{color:"var(--text-secondary)"}}):t.jsx(p,{className:"w-5 h-5",style:{color:"var(--text-secondary)"}}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm truncate",style:{color:"var(--text-primary)"},children:e.name}),t.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[e.size?`${e.size} ‚Ä¢ `:"",e.date]})]}),"file"===e.type&&t.jsx(x,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--text-secondary)"}})]},e.id))})}),t.jsxs($,{title:"Personal Notepad",isOpen:u.notes,onToggle:()=>j("notes"),children:[t.jsx("textarea",{value:f,onChange:e=>{return t=e.target.value,v(t),w.current&&clearTimeout(w.current),void(w.current=setTimeout(()=>{localStorage.setItem(`chat_notes_${r.id}`,t)},500));var t},placeholder:"Add private notes about this conversation...",className:"w-full h-32 p-3 rounded-lg text-sm resize-none focus:outline-none focus:ring-1",style:{backgroundColor:"var(--bg-elevated)",border:"1px solid var(--border-subtle)",color:"var(--text-primary)"}}),t.jsx("p",{className:"text-xs mt-2",style:{color:"var(--text-secondary)"},children:"Notes are saved automatically and only visible to you."})]})]})]})})]})}const P="messages_cache_";function W(e){try{const t=localStorage.getItem(P+e);if(t){const s=JSON.parse(t);if("1"!==s.version)return null;return Date.now()-s.timestamp>3e5?(localStorage.removeItem(P+e),null):s.messages||null}}catch{}return null}function H(e,t){try{const s={messages:t,timestamp:Date.now(),version:"1"};localStorage.setItem(P+e,JSON.stringify(s))}catch{}}const V="conversations_cache";function Y(e){try{const t=sessionStorage.getItem(V);if(t){const s=JSON.parse(t);if("1"!==s.version||s.customerId!==e)return null;return Date.now()-s.timestamp>6e5?(sessionStorage.removeItem(V),null):s.conversations||null}}catch{}return null}const G="admin_conversations_cache";function J(e){try{const t=sessionStorage.getItem(G);if(t){const s=JSON.parse(t);if("1"!==s.version||s.adminId!==e)return null;return Date.now()-s.timestamp>6e5?(sessionStorage.removeItem(G),null):s.conversations||null}}catch{}return null}class K extends Error{constructor(e,t,s=!0,n){super(e),this.code=t,this.recoverable=s,this.originalError=n,this.name="MessagingError"}}const X="NETWORK_ERROR";function Z(e){const[t,n]=s.useState(null),[i,o]=s.useState(()=>({conversations:"undefined"!=typeof window&&e&&Y(e)||[],selectedConversationId:null,isSelectionLocked:!1,connectionStatus:"connecting",error:null})),[l,c]=s.useState(()=>{if("undefined"!=typeof window&&e){const t=Y(e);return!t||0===t.length}return!0}),d=i.conversations,u=s.useCallback((t,s=!1)=>{o(e=>({...e,selectedConversationId:t,isSelectionLocked:s})),s&&setTimeout(()=>{o(e=>({...e,isSelectionLocked:!1}))},1e3),e&&localStorage.setItem(`lastConversation_${e}`,t)},[e]),m=s.useCallback((e,t)=>{o(s=>({...s,conversations:s.conversations.map(s=>s.id===e?{...s,unread_count_customer:t}:s)}))},[]),x=s.useCallback(async()=>{if(!e)return o(e=>({...e,conversations:[]})),void c(!1);try{const{data:t,error:s}=await r.from("conversations").select("\n          *,\n          admin:profiles!conversations_admin_id_fkey(*)\n        ").or(`customer_id.eq.${e},admin_id.eq.${e}`).order("last_message_at",{ascending:!1});if(s)return o(e=>({...e,error:new K("Failed to load conversations",X,!0,s)})),void c(!1);if(t){let s=t;const n=s.map(t=>t.customer_id===e?t.admin_id:t.customer_id).filter(Boolean);if(n.length>0){const{data:t,error:a}=await r.from("unified_users").select("id, first_name, last_name, username, avatar_url, display_name, is_admin, is_online, last_seen").in("id",n),{data:i}=await r.from("profiles").select("id, name, username, avatar_url, is_admin, is_online, last_seen").in("id",n),o=new Map((t||[]).map(e=>[e.id,e])),l=new Map((i||[]).map(e=>[e.id,e]));s=s.map(t=>{const s=t.customer_id===e?t.admin_id:t.customer_id,n=o.get(s||""),r=l.get(s||"");return n?{...t,admin:{id:n.id,name:n.display_name||[n.first_name,n.last_name].filter(Boolean).join(" ")||"User",username:n.username||"",avatar_url:n.avatar_url||"",is_admin:n.is_admin||!1,is_online:n.is_online||!1,last_seen:n.last_seen}}:r?{...t,admin:{id:r.id,name:r.name||"User",username:r.username||"",avatar_url:r.avatar_url||"",is_admin:r.is_admin||!1,is_online:r.is_online||!1,last_seen:r.last_seen}}:t.admin?t:{...t,admin:{id:s||"",name:"User",username:"",avatar_url:"",is_admin:!1,is_online:!1}}})}s.sort((e,t)=>e.is_pinned&&!t.is_pinned?-1:!e.is_pinned&&t.is_pinned?1:new Date(t.last_message_at).getTime()-new Date(e.last_message_at).getTime()),o(e=>({...e,conversations:s,error:null})),function(e,t){try{const s={conversations:t,timestamp:Date.now(),version:"1",customerId:e};sessionStorage.setItem(V,JSON.stringify(s))}catch{}}(e,s),s.forEach(e=>{var t;(null==(t=e.admin)?void 0:t.avatar_url)&&a(e.admin.avatar_url)})}}catch(t){o(e=>({...e,error:new K("Failed to load conversations",X,!0,t)}))}c(!1)},[e]);s.useEffect(()=>{if(!e)return o(e=>({...e,conversations:[]})),void c(!1);sessionStorage.getItem("session_start")||sessionStorage.setItem("session_start",(new Date).toISOString());const t=Y(e);t&&t.length>0&&(o(e=>({...e,conversations:t})),c(!1)),x();let s=0;const n=r.channel(`customer-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`customer_id=eq.${e}`},e=>{const t=e.new;if("UPDATE"===e.eventType&&(null==t?void 0:t.id)){const e=t;return void o(t=>{const s=t.conversations.findIndex(t=>t.id===e.id);if(s>=0){const n=[...t.conversations],r=t.conversations[s].admin;return n[s]={...e,admin:r},n.sort((e,t)=>e.is_pinned&&!t.is_pinned?-1:!e.is_pinned&&t.is_pinned?1:new Date(t.last_message_at).getTime()-new Date(e.last_message_at).getTime()),{...t,conversations:n}}return t})}x()}).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`admin_id=eq.${e}`},()=>{x()}).subscribe(e=>{if("SUBSCRIBED"===e)o(e=>({...e,connectionStatus:"connected"})),s=0;else if(("CHANNEL_ERROR"===e||"TIMED_OUT"===e)&&(o(e=>({...e,connectionStatus:"disconnected"})),s<5)){const e=Math.min(1e3*Math.pow(2,s),3e4);s++,setTimeout(()=>{n.subscribe()},e)}});return()=>{n.unsubscribe()}},[e,x]);const g=s.useCallback(async t=>{const s=i.conversations.find(s=>s.customer_id===e&&s.admin_id===t.id||s.customer_id===t.id&&s.admin_id===e);if(s)return u(s.id,!0),n(null),{type:"existing",conversation:s};const{data:a}=await r.from("conversations").select("*, admin:profiles!conversations_admin_id_fkey(*)").or(`and(customer_id.eq.${e},admin_id.eq.${t.id}),and(customer_id.eq.${t.id},admin_id.eq.${e})`).maybeSingle();if(a){const e=a;return o(t=>({...t,conversations:[e,...t.conversations.filter(t=>t.id!==e.id)],selectedConversationId:e.id,isSelectionLocked:!0})),n(null),setTimeout(()=>o(e=>({...e,isSelectionLocked:!1})),1e3),{type:"existing",conversation:e}}return n({recipientId:t.id,recipientUser:t}),o(e=>({...e,selectedConversationId:null})),{type:"pending",recipientId:t.id}},[i.conversations,e,u]),h=s.useCallback(async(s,a,i="text",l,c)=>{if(!s&&t)try{const{data:s,error:d}=await r.from("conversations").insert({customer_id:e,admin_id:t.recipientId,last_message:a.length>80?a.substring(0,80)+"...":a,last_message_at:(new Date).toISOString(),last_message_sender_id:e,unread_count_admin:1,unread_count_customer:0,is_ephemeral:!1,has_messages:!0}).select().single();if(d)throw d;const{data:u,error:m}=await r.from("messages").insert({conversation_id:s.id,sender_id:e,content:a,type:i,image_url:l||null,status:"sent",reply_to_id:(null==c?void 0:c.id)||null,reply_to_sender_name:(null==c?void 0:c.senderName)||"",reply_to_content:(null==c?void 0:c.content)||""}).select().single();if(m)throw m;const x={...s,admin:{id:t.recipientUser.id,name:t.recipientUser.display_name,username:t.recipientUser.username,avatar_url:t.recipientUser.avatar_url||"",is_admin:!1,is_online:!1}};return n(null),o(e=>({...e,conversations:[x,...e.conversations],selectedConversationId:s.id,isSelectionLocked:!0})),setTimeout(()=>o(e=>({...e,isSelectionLocked:!1})),1e3),{data:u,error:null,newConversationId:s.id}}catch(d){return{data:null,error:d,newConversationId:null}}return{data:null,error:new Error("Use useChat hook for existing conversations"),newConversationId:null}},[t,e]),p=s.useCallback(()=>{n(null)},[]);return{conversations:d,loading:l,updateConversationUnreadCount:m,refetch:x,selectConversation:u,selectedConversationId:i.selectedConversationId,isSelectionLocked:i.isSelectionLocked,connectionStatus:i.connectionStatus,error:i.error,pendingConversation:t,setPendingConversation:n,startConversationWith:g,sendMessageToConversation:h,clearPendingConversation:p}}function Q(e){const[t,n]=s.useState(null),[a,i]=s.useState(!0);return s.useEffect(()=>{(async()=>{const{data:t,error:s}=await r.from("profiles").select("*").eq("id",e).maybeSingle();!s&&t&&n(t),i(!1)})();const t=r.channel(`profile:${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${e}`},e=>{n(e.new)}).subscribe();return()=>{t.unsubscribe()}},[e]),{profile:t,loading:a}}function ee(e){s.useEffect(()=>{const t=async t=>{await r.from("profiles").update({is_online:t,last_seen:(new Date).toISOString()}).eq("id",e)};t(!0);const s=()=>{t(!document.hidden)},n=()=>{t(!1)};return document.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",n),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("beforeunload",n),t(!1)}},[e])}async function te(){try{const{data:e,error:t}=await r.from("profiles").select("id, name, is_admin").eq("is_admin",!0).limit(1).maybeSingle();return t?null:e?e.id:null}catch(e){return null}}async function se(e){var t,s,n,a,i,o;try{const{data:l,error:c}=await r.from("profiles").select("id").eq("id",e).maybeSingle();if(c)return null;if(!l){const{data:s,error:n}=await r.from("users").select("email, first_name, last_name, full_name").eq("id",e).maybeSingle();if(n)return null;const a=(null==s?void 0:s.full_name)||((null==s?void 0:s.first_name)&&(null==s?void 0:s.last_name)?`${s.first_name} ${s.last_name}`.trim():null)||(null==(t=null==s?void 0:s.email)?void 0:t.split("@")[0])||"User",{error:i}=await r.from("profiles").insert({id:e,name:a,avatar_url:"",is_admin:!1,is_online:!1});if(i)return null}const d=await te();if(!d)return null;const{data:u,error:m}=await r.from("conversations").select("*").eq("customer_id",e).eq("admin_id",d).maybeSingle();if(m&&"PGRST116"!==m.code)return null;if(u){const{data:e,error:t}=await r.from("profiles").select("*").eq("id",d).single();return t?null:e?{...u,admin:e}:null}const{data:x,error:g}=await r.from("conversations").insert({customer_id:e,admin_id:d,last_message:"",unread_count_admin:0,unread_count_customer:0}).select("*").single();if(g){if("23505"===g.code||"409"===g.code||"PGRST204"===g.code||(null==(s=g.message)?void 0:s.toLowerCase().includes("duplicate"))||(null==(n=g.message)?void 0:n.toLowerCase().includes("unique"))||(null==(a=g.message)?void 0:a.toLowerCase().includes("conflict"))||(null==(i=g.message)?void 0:i.toLowerCase().includes("already exists"))){const{data:t,error:s}=await r.from("conversations").select("*").eq("customer_id",e).eq("admin_id",d).maybeSingle();if(s)return null;if(t){const{data:e,error:s}=await r.from("profiles").select("*").eq("id",d).single();if(s)return null;if(e)return{...t,admin:e}}}return null}const{data:h}=await r.from("users").select("first_name").eq("id",e).maybeSingle(),p=(null==(o=null==h?void 0:h.first_name)?void 0:o.trim())||"",y=`Hi${p?` ${p},`:""} welcome to Elevate! üëã\n\nIf you have any questions, feel free to ask.\n\nHave suggestions or feedback? You can submit them here. We review everything and are always working to give you the best experience on Elevate.`,{error:f}=await r.from("messages").insert({conversation_id:x.id,sender_id:d,type:"text",content:y,status:"sent"});if(f);else{const e=y.split("\n")[0];await r.from("conversations").update({last_message:e,last_message_at:(new Date).toISOString(),last_message_sender_id:d,unread_count_customer:1}).eq("id",x.id)}const{data:v,error:b}=await r.from("profiles").select("*").eq("id",d).single();return b?null:v&&x?{...x,admin:v}:null}catch(l){return null}}function ne(e){const[t,n]=s.useState(()=>{if("undefined"!=typeof window&&e){return J(e)||[]}return[]}),[i,o]=s.useState(()=>{if("undefined"!=typeof window&&e){const t=J(e);return!t||0===t.length}return!0}),l=s.useRef(!1);return s.useEffect(()=>{if(!e)return n([]),void o(!1);const t=J(e);t&&t.length>0&&(n(t),o(!1));const s=async()=>{l.current||t||o(!0);const{data:s,error:i}=await r.from("conversations").select("*").eq("admin_id",e);if(i)return n([]),o(!1),void(l.current=!0);if(!s||0===s.length)return n([]),o(!1),void(l.current=!0);const c=[...new Set(s.map(e=>e.customer_id))],d=s.map(e=>e.id),{data:u,error:m}=await r.from("profiles").select("*").in("id",c);if(m)return n([]),o(!1),void(l.current=!0);const{data:x,error:g}=await r.from("messages").select("conversation_id, created_at, sender_id").in("conversation_id",d).order("created_at",{ascending:!1}),h=new Map;if(x)for(const e of x){const t=s.find(t=>t.id===e.conversation_id);t&&e.sender_id===t.customer_id&&(h.has(e.conversation_id)||h.set(e.conversation_id,e.created_at))}const p=new Map((u||[]).map(e=>[e.id,e])),y=s.map(e=>({...e,customer:p.get(e.customer_id)||null,last_customer_message_at:h.get(e.id)||e.last_message_at})).filter(e=>null!==e.customer);y.forEach(e=>{var t;(null==(t=e.customer)?void 0:t.avatar_url)&&a(e.customer.avatar_url)}),y.sort((e,t)=>{const s=h.has(e.id),n=h.has(t.id);if(s&&!n)return-1;if(!s&&n)return 1;const r=e.last_customer_message_at?new Date(e.last_customer_message_at).getTime():e.last_message_at?new Date(e.last_message_at).getTime():0;return(t.last_customer_message_at?new Date(t.last_customer_message_at).getTime():t.last_message_at?new Date(t.last_message_at).getTime():0)-r}),n(y),function(e,t){try{const s={conversations:t,timestamp:Date.now(),version:"1",adminId:e};sessionStorage.setItem(G,JSON.stringify(s))}catch{}}(e,y),o(!1),l.current=!0};s();const i=r.channel(`admin-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`admin_id=eq.${e}`},()=>{s()}).subscribe();return()=>{i.unsubscribe()}},[e]),{conversations:t,loading:i}}const re=s.memo(function({conversation:e,otherUser:s,currentUserId:n,getSenderName:r,onMarkAsRead:a,backgroundTheme:i="dark",onBack:o,showBackButton:l=!1,isPending:c=!1,pendingRecipient:d,onSendPendingMessage:u,onCancelPending:m}){return c&&d?t.jsxs("div",{className:"flex flex-col h-full",style:{backgroundColor:"var(--bg-primary)"},children:[t.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b",style:{borderColor:"var(--border-default)",backgroundColor:"var(--bg-sidebar)"},children:[m&&t.jsx("button",{onClick:m,className:"p-1 rounded-lg hover:bg-white/5 transition-colors lg:hidden",style:{color:"var(--text-secondary)"},children:"‚Üê"}),t.jsx("img",{src:d.avatar_url||"/default-avatar.png",alt:d.display_name,className:"w-10 h-10 rounded-full object-cover"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:d.display_name}),t.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:["@",d.username]})]})]}),t.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden",style:{border:"3px solid var(--border-default)"},children:t.jsx("img",{src:d.avatar_url||"/default-avatar.png",alt:d.display_name,className:"w-full h-full object-cover"})}),t.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:"var(--text-primary)"},children:d.display_name}),t.jsxs("p",{className:"text-sm mb-4",style:{color:"var(--text-muted)"},children:["@",d.username]}),t.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Send a message to start the conversation"})]})}),t.jsx("div",{style:{borderTop:"1px solid var(--border-default)",backgroundColor:"var(--bg-sidebar)",padding:"12px 16px"},children:t.jsx(L,{onSendMessage:async e=>{u&&e.trim()&&await u(e)},onTyping:()=>{},disabled:!1,otherUserName:d.username})})]}):e&&s?t.jsx(ae,{conversation:e,otherUser:s,currentUserId:n,getSenderName:r,onMarkAsRead:a,backgroundTheme:i,onBack:o,showBackButton:l}):null}),ae=s.memo(function({conversation:e,otherUser:n,currentUserId:a,getSenderName:i,onMarkAsRead:o,backgroundTheme:l="dark",onBack:c,showBackButton:d=!1}){const{messages:u,loading:m,otherUserTyping:x,sendMessage:g,setTyping:h,markMessagesAsSeen:p}=function({conversationId:e,currentUserId:t}){const[n,a]=s.useState(()=>"undefined"!=typeof window&&W(e)||[]),[i,o]=s.useState(()=>{if("undefined"!=typeof window){const t=W(e);return!t||0===t.length}return!0}),[l,c]=s.useState(!1),d=s.useRef(null),u=s.useCallback(async()=>{if(e)try{const{data:t,error:s}=await r.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(s)return void o(!1);if(t){const s=t;a(s),H(e,s)}}catch(t){}finally{o(!1)}else o(!1)},[e]);return s.useEffect(()=>{if(!e)return;const s=W(e);s&&s.length>0?(a(s),o(!1)):(a([]),o(!0)),u();const n=r.channel(`messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},t=>{const s=t.new;a(t=>{if(t.some(e=>e.id===s.id))return t;const n=[...t,s];return H(e,n),n})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},t=>{const s=t.new;a(t=>{const n=t.map(e=>e.id===s.id?s:e);return H(e,n),n})}).subscribe(),i=r.channel(`typing:${e}`).on("broadcast",{event:"typing"},({payload:e})=>{e.userId!==t&&c(e.isTyping)}).subscribe();return d.current=i,()=>{n.unsubscribe(),i.unsubscribe()}},[e,t,u]),{messages:n,loading:i,otherUserTyping:l,sendMessage:s.useCallback(async(s,n,a)=>{const i=n?"image":"text",{data:o,error:l}=await r.from("messages").insert({conversation_id:e,sender_id:t,type:i,content:s||"",image_url:n||"",status:"sent",reply_to_id:(null==a?void 0:a.id)||null,reply_to_sender_name:(null==a?void 0:a.senderName)||"",reply_to_content:(null==a?void 0:a.content)||""}).select().single();if(l)return{data:null,error:l};if(o){const{data:n}=await r.from("conversations").select("customer_id, admin_id, unread_count_admin, unread_count_customer, is_ephemeral").eq("id",e).single();if(n){const a=n.customer_id===t;let i=s||"Sent an image";"Sent an image"!==i&&(i=i.replace(/\n/g," ").trim(),i.startsWith("Me: ")&&(i=i.substring(4).trim()),i.length>80&&(i=i.substring(0,80)+"..."));const o={last_message:i,last_message_at:(new Date).toISOString(),last_message_sender_id:t,is_ephemeral:!1,has_messages:!0};a?(o.unread_count_customer=0,o.unread_count_admin=(n.unread_count_admin||0)+1):(o.unread_count_admin=0,o.unread_count_customer=(n.unread_count_customer||0)+1);const{error:l}=await r.from("conversations").update(o).eq("id",e)}}return{data:o,error:null}},[e,t]),setTyping:s.useCallback(e=>{var s;null==(s=d.current)||s.send({type:"broadcast",event:"typing",payload:{userId:t,isTyping:e}})},[t]),markMessagesAsSeen:s.useCallback(async()=>{const{data:s}=await r.from("conversations").select("customer_id, admin_id").eq("id",e).single();if(s){const n=s.customer_id===t;await r.from("messages").update({status:"seen"}).eq("conversation_id",e).neq("sender_id",t).neq("status","seen");const a={};n?a.unread_count_customer=0:a.unread_count_admin=0;const{error:i}=await r.from("conversations").update(a).eq("id",e)}},[e,t])}}({conversationId:e.id,currentUserId:a}),{uploadImage:y,uploading:f}=function(){const[e,t]=s.useState(!1);return{uploadImage:async e=>{var s;t(!0);try{const t=new FormData;t.append("image",e);const n=await fetch("https://api.imgbb.com/1/upload?key=012774bd056a91a1055131cf67c1a486",{method:"POST",body:t});if(n.ok){const e=await n.json();if(null==(s=e.data)?void 0:s.url)return e.data.url}const r=new FileReader;return new Promise((t,s)=>{r.onerror=()=>{s(new Error("Failed to read image"))},r.onloadend=()=>{t(r.result)},r.readAsDataURL(e)})}catch(n){const t=new FileReader;return new Promise((s,n)=>{t.onerror=()=>{n(new Error("Failed to read image"))},t.onloadend=()=>{s(t.result)},t.readAsDataURL(e)})}finally{t(!1)}},uploading:e}}(),v=s.useRef(null),b=s.useRef(null),[w,j]=s.useState(null),[_,k]=s.useState(!1),N=s.useRef(null),C=s.useRef(!1),S=s.useRef(!0),F=s.useRef(!0),[E,M]=s.useState(()=>{if("undefined"!=typeof window){const s=localStorage.getItem(`messages_cache_${e.id}`);if(s)try{const e=JSON.parse(s);if(e.messages&&e.messages.length>0)return!0}catch(t){}}return!1}),I=s.useRef({}),D=s.useMemo(()=>u.filter(e=>"image"===e.type&&e.image_url),[u]);s.useEffect(()=>{S.current=!0,F.current=!0,I.current={};const t=localStorage.getItem(`messages_cache_${e.id}`);if(t)try{const e=JSON.parse(t);if(e.messages&&e.messages.length>0)return void M(!0)}catch(s){}M(!1)},[e.id]),s.useEffect(()=>{!m&&u.length>0?M(!0):m||0!==u.length||M(!0)},[m,u.length]);const B=s.useCallback((e,t)=>{I.current[e]=t;D.every(e=>!0===I.current[e.id])&&!m&&M(!0)},[D,m]),q=s.useCallback(async(e,t)=>{if(t)try{const{error:t}=await r.from("messages").update({deleted_at:(new Date).toISOString(),deleted_by:a}).eq("id",e);if(t)return}catch(s){return}},[a]);s.useEffect(()=>{!m&&u.length>0&&v.current&&F.current&&E&&(v.current.scrollIntoView({behavior:S.current?"instant":"smooth"}),S.current&&(S.current=!1))},[m,u.length,e.id,E]),s.useEffect(()=>(C.current=!1,()=>{C.current=!1}),[e.id]),s.useEffect(()=>{u.length>0&&!C.current&&p().then(()=>{C.current=!0,o&&o(e.id)})},[e.id,u.length,p,o]),s.useEffect(()=>{if(u.length>0&&b.current){N.current&&clearTimeout(N.current);const t=b.current;return t.scrollHeight-t.scrollTop<=t.clientHeight+100&&(N.current=setTimeout(()=>{p().then(()=>{o&&o(e.id)})},2e3)),()=>{N.current&&clearTimeout(N.current)}}},[u.length,p,e.id,o]);const O=s.useCallback(e=>{j(e)},[]);s.useCallback(()=>{j(null)},[]);const $=s.useCallback(e=>{const t=document.getElementById(`message-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-neutral-700/30"),setTimeout(()=>{t.classList.remove("bg-neutral-700/30")},1500))},[]);return t.jsxs("div",{className:"flex-1 flex flex-col min-h-0 min-w-0 overflow-hidden",style:{backgroundColor:"var(--bg-primary)",height:"100%"},children:[t.jsx(T,{user:n,isTyping:x,onVideoCall:()=>{},onScheduleMeeting:()=>{},onOpenDrawer:()=>k(!0),isDrawerOpen:_,backgroundTheme:l,onBack:c,showBackButton:d}),t.jsxs("div",{className:"flex-1 min-h-0 relative",children:[!E&&t.jsx("div",{className:"absolute inset-0 z-10 flex flex-col",style:{backgroundColor:"var(--bg-primary)",transition:"opacity 150ms ease-out",opacity:1,pointerEvents:"none"},children:t.jsx("div",{className:"flex-1 py-2 lg:py-4 flex flex-col justify-end animate-pulse",children:t.jsxs("div",{className:"space-y-0.5 lg:space-y-1 px-2 lg:px-4",children:[t.jsx("div",{className:"flex justify-start px-2 lg:px-4 py-0.5",children:t.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%]",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(75, 85, 99, 0.15)",minHeight:"2.5rem",width:"180px"}}),t.jsx("div",{className:"h-3 rounded px-1",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})}),t.jsx("div",{className:"flex justify-end px-2 lg:px-4 py-0.5",children:t.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%] flex-row-reverse",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(248, 250, 252, 0.1)",minHeight:"2.5rem",width:"140px"}}),t.jsx("div",{className:"h-3 rounded px-1 ml-auto",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})}),t.jsx("div",{className:"flex justify-start px-2 lg:px-4 py-0.5",children:t.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%]",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(75, 85, 99, 0.15)",minHeight:"3.5rem",width:"220px"}}),t.jsx("div",{className:"h-3 rounded px-1",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})})]})})}),t.jsx("div",{ref:b,className:"absolute inset-0 overflow-y-auto",style:{backgroundColor:"var(--bg-primary)",scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.3) transparent",overflowY:"auto",WebkitOverflowScrolling:"touch"},onScroll:()=>{if(b.current){const t=b.current,s=t.scrollHeight-t.scrollTop<=t.clientHeight+50;F.current=s,s&&u.length>0&&(N.current&&clearTimeout(N.current),p().then(()=>{o&&o(e.id)}))}},children:t.jsxs("div",{className:"py-2 lg:py-4 min-h-full flex flex-col justify-end",children:[0!==u.length||m?t.jsx("div",{className:"space-y-0.5 lg:space-y-1 px-2 lg:px-2 "+(E?"chat-content-ready":"chat-content-loading"),children:u.map((e,s)=>{const n=s>0?u[s-1]:null,r=new Date(e.created_at),o=n?new Date(n.created_at):null,l=!(o&&(c=r,d=o,c.getFullYear()===d.getFullYear()&&c.getMonth()===d.getMonth()&&c.getDate()===d.getDate()));var c,d;return t.jsxs("div",{children:[l&&t.jsx("div",{className:"flex items-center justify-center py-5",children:t.jsx("div",{className:"px-3 py-1.5 rounded-lg",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-default)"},children:t.jsx("span",{className:"text-xs font-medium",style:{color:"#94A3B8"},children:R(e.created_at)})})}),t.jsx(U,{message:e,isOwn:e.sender_id===a,onReply:O,onScrollToMessage:$,senderName:i(e.sender_id),onImageLoad:B,onDelete:q})]},e.id)})}):t.jsx("div",{className:"flex-1 flex items-start justify-center pt-12 lg:pt-16",children:t.jsxs("div",{className:"text-center px-4 lg:px-6",children:[t.jsx("div",{className:"w-20 h-20 lg:w-24 lg:h-24 mx-auto mb-4 rounded-full overflow-hidden",style:{border:"3px solid var(--border-default)"},children:n.avatar_url?t.jsx("img",{src:n.avatar_url,alt:n.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:"var(--bg-elevated)"},children:t.jsx("svg",{className:"w-10 h-10 lg:w-12 lg:h-12",style:{color:"#64748B"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),t.jsx("h3",{className:"text-base lg:text-lg font-semibold mb-1",style:{color:"var(--text-primary)"},children:n.name}),n.username&&t.jsxs("p",{className:"text-sm mb-1",style:{color:"var(--text-muted)"},children:["@",n.username]}),n.created_at&&t.jsxs("p",{className:"text-xs mb-4",style:{color:"var(--text-muted)"},children:["Joined ",new Date(n.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),t.jsx("button",{onClick:()=>k(!0),className:"px-5 py-2 rounded-full text-sm font-semibold transition-all duration-200 hover:brightness-110",style:{backgroundColor:"var(--text-primary)",color:"var(--bg-primary)"},children:"View Profile"})]})}),x&&t.jsx(A,{}),t.jsx("div",{ref:v})]})})]}),t.jsx(L,{onSendMessage:async(t,s,n)=>{j(null),F.current=!0;try{let r;if(s&&(r=await y(s)||void 0,!r))throw new Error("Failed to upload image");const a=await g(t,r,n);if(null==a?void 0:a.error)throw a.error;o&&o(e.id)}catch(r){}},onTyping:h,disabled:m,replyTo:w,onCancelReply:()=>j(null),otherUserName:(null==n?void 0:n.username)||""}),t.jsx(z,{isOpen:_,onClose:()=>k(!1),user:n})]})}),ie={sm:{container:"w-8 h-8"},md:{container:"w-10 h-10"},lg:{container:"w-12 h-12"}};function oe({src:e,name:n,size:r="md",isOnline:o,showOnlineIndicator:l=!1,isAdmin:c=!1}){const[d,u]=s.useState(!1),[m,x]=s.useState(!1),[g,h]=s.useState(null),p=s.useRef(null),y=c?N:e||"",f=y&&""!==y.trim();s.useEffect(()=>{if(!f)return void x(!0);const e=i(y);if(!e){a(y),u(!1),x(!1);const e=function(e,t,s){const n=new Image;return n.onload=t,n.onerror=s,n.src=e,n}(y,()=>u(!0),()=>x(!0));return p.current=e,()=>{p.current&&(p.current.onload=null,p.current.onerror=null)}}h(e),u(!0),a(y)},[y,f]);const v=g||y,b=f&&(d||g)&&!m,w=k;return t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsxs("div",{className:`${ie[r].container} rounded-full flex items-center justify-center overflow-hidden relative`,children:[t.jsx("img",{src:w,alt:n,className:`${ie[r].container} rounded-full object-cover absolute inset-0 default-avatar-shake`,style:{opacity:b?0:1,transition:"opacity 0.2s ease-in-out"}}),f&&t.jsx("img",{src:v,alt:n,className:`${ie[r].container} rounded-full object-cover absolute inset-0`,style:{opacity:b?1:0,transition:"none"},onLoad:()=>{g||u(!0)},onError:()=>x(!0),loading:"eager",decoding:"async",fetchpriority:"high"})]}),l&&t.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 border-2 rounded-full z-10",style:{borderColor:"#111111",backgroundColor:o?"#10b981":"#64748B"}})]})}function le({x:e,y:n,onClose:r,onPin:a,isPinned:i=!1}){const o=s.useRef(null);return s.useEffect(()=>{const e=e=>{o.current&&!o.current.contains(e.target)&&r()},t=e=>{"Escape"===e.key&&r()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[r]),s.useEffect(()=>{if(o.current){const t=o.current,s=t.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;s.right>r&&(t.style.left=e-s.width+"px"),s.bottom>a&&(t.style.top=n-s.height+"px")}},[e,n]),t.jsx("div",{ref:o,className:"fixed rounded-lg shadow-lg py-1 min-w-[200px] z-50",style:{left:e,top:n,backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:t.jsxs("button",{onClick:()=>{null==a||a(),r()},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:brightness-110 transition-colors",style:{color:"#F8FAFC"},children:[t.jsx(f,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:i?"Unpin":"Pin"})]})})}const ce=s.memo(function({user:e,conversation:n,isActive:r,onClick:a,onPin:i,unreadCount:o,currentUserId:l}){const c=void 0!==o?o:n.unread_count_customer,[d,u]=s.useState(null),m=n.last_message?(()=>{let e=n.last_message.replace(/\n/g," ").trim();return e.startsWith("Me: ")&&(e=e.substring(4).trim()),l&&n.last_message_sender_id===l?"Me: "+e:e})():"No messages yet";return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:a,onContextMenu:e=>{e.preventDefault(),u({x:e.clientX,y:e.clientY})},className:"w-full flex items-center gap-2 lg:gap-3 px-3 lg:px-4 py-2 lg:py-3 transition-colors text-left "+(r?"":"hover:brightness-110"),style:r?{backgroundColor:"var(--bg-elevated)"}:{backgroundColor:"transparent"},children:[t.jsx(oe,{src:e.avatar_url,name:e.name,size:"lg",isAdmin:e.is_admin}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[t.jsx("span",{className:"text-sm lg:text-base font-medium truncate",style:{color:"var(--text-primary)"},children:e.name}),t.jsx("span",{className:"text-[10px] lg:text-xs flex-shrink-0 ml-2",style:{color:"var(--text-secondary)"},children:q(n.last_message_at)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-xs lg:text-sm truncate pr-2",style:{color:"var(--text-secondary)"},children:m}),c>0&&t.jsx("span",{className:"flex-shrink-0 min-w-[18px] lg:min-w-[20px] h-4 lg:h-5 px-1 lg:px-1.5 flex items-center justify-center text-[10px] lg:text-xs font-medium rounded-full",style:{backgroundColor:"#ef4444",color:"#FFFFFF"},children:c>99?"99+":c})]})]})]}),d&&t.jsx(le,{x:d.x,y:d.y,onClose:()=>u(null),onPin:()=>{null==i||i(n.id,!n.is_pinned)},isPinned:n.is_pinned})]})});function de(e,t){let s=null;return function(...n){s&&clearTimeout(s),s=setTimeout(()=>{s=null,e(...n)},t)}}export{c as A,m as C,k as D,N as E,p as L,y as M,b as S,ce as U,_ as X,Q as a,ee as b,re as c,de as d,d as e,u as f,se as g,ne as h,w as i,te as j,Z as u};

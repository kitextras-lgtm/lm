import{j as e}from"./spline-OfIZ-5GP.js";import{u as t,d as r,r as s}from"./react-vendor-ClpDbY_3.js";import{s as a}from"./index-BeWpAAxC.js";import"./supabase-Dq2D-Wrk.js";function l(){const l=t(),o=r(),[i,n]=s.useState(""),[c,d]=s.useState(""),[u,m]=s.useState(""),[p,f]=s.useState(null),[x,h]=s.useState(null),[v,g]=s.useState(!1),[y,b]=s.useState(null),[w,j]=s.useState(null),[N,k]=s.useState(!1),[S,F]=s.useState(window.innerWidth<640);s.useEffect(()=>{const e=setTimeout(()=>{k(!0)},100);return()=>clearTimeout(e)},[]),s.useEffect(()=>{const e=()=>F(window.innerWidth<640);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{var e,t;if("artist"===(null==(e=o.state)?void 0:e.userType))return void j("artist");if("freelancer"===(null==(t=o.state)?void 0:t.userType))return void j("freelancer");(async()=>{const e=localStorage.getItem("verifiedUserId"),{data:{user:t}}=await a.auth.getUser(),r=(null==t?void 0:t.id)||e;if(r){const{data:e}=await a.from("users").select("user_type").eq("id",r).maybeSingle();e&&j(e.user_type)}})()},[o.state]),s.useEffect(()=>{const e=localStorage.getItem("tempProfile");if(e)try{const t=JSON.parse(e);t.firstName&&n(t.firstName),t.lastName&&d(t.lastName),t.username&&m(t.username),t.profilePicture&&h(t.profilePicture)}catch(t){}},[]);const E=async()=>{var e,t;if(i&&u){g(!0),b(null);try{const{data:{user:s}}=await a.auth.getUser(),n=localStorage.getItem("verifiedUserId"),d=localStorage.getItem("verifiedEmail"),m=(null==s?void 0:s.id)||n;if(!m)return b(d?"User ID not found. Please try signing up again or contact support.":"Please complete sign-up first. Go back to sign up page."),void g(!1);let f=null;if(p)try{const e=new FileReader;f=await new Promise((t,r)=>{e.onload=()=>{const r=e.result.split(",")[1];t(r)},e.onerror=r,e.readAsDataURL(p)})}catch(r){return b(`Failed to process profile picture: ${r.message}`),void g(!1)}const h="undefined/functions/v1/save-profile",v=await fetch(h,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify({userId:m,firstName:i,lastName:c,username:u,email:localStorage.getItem("verifiedEmail"),...w&&{userType:w},profilePictureBase64:f,profilePictureFileName:(null==p?void 0:p.name)||null})}),y=await v.json();if(!y.success)throw new Error(y.message||"Failed to save profile");const j={firstName:i,lastName:c,username:u,profilePicture:x,userType:w};localStorage.setItem("tempProfile",JSON.stringify(j)),"artist"===w||"artist"===(null==(e=o.state)?void 0:e.userType)?l("/tell-us-about-yourself",{state:{userType:"artist"}}):"freelancer"===w||"freelancer"===(null==(t=o.state)?void 0:t.userType)?l("/freelancer-onboarding"):l("/tell-us-about-yourself")}catch(s){b(s.message||"Failed to save profile"),g(!1)}}else b("Please fill in all required fields")},C=i&&c?`${i} ${c}`:i||"Your name",L=u?`@${u}`:"@username";return e.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center relative overflow-hidden py-8 sm:py-12 px-6",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E\")"},children:[e.jsxs("button",{onClick:()=>{const e="artist"===new URLSearchParams(window.location.search).get("source");localStorage.removeItem("verifiedUserId"),localStorage.removeItem("verifiedEmail"),localStorage.removeItem("tempProfile"),l(e?"/learn/artist":"/signup")},className:"fixed top-6 left-6 z-50 flex items-center gap-1.5 text-gray-400 hover:text-white transition-colors group",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Back"})]}),!S&&e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none transition-opacity duration-700 ease-out overflow-hidden",style:{opacity:N?1:0,transform:"translateX(30%) scale(1.035)"},children:e.jsx("spline-viewer",{url:"https://prod.spline.design/hxB6DGH8u6Rcpq21/scene.splinecode","mouse-controls":"false",className:"spline-viewer-no-watermark"})}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm flex flex-col items-center",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-3",style:{color:"#F2F4F7"},children:"Make your profile"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:"Create your unique identity on Elevate"})]}),e.jsx("div",{className:"w-full p-6 relative overflow-hidden",style:{background:"rgba(10, 10, 15, 0.65)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",border:"1px solid rgba(255, 255, 255, 0.06)",borderRadius:"16px",boxShadow:"0 24px 48px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.03)"},children:e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center overflow-hidden border-2 border-white/10",children:x?e.jsx("img",{src:x,alt:"Profile preview",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsxs("label",{className:"absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full flex items-center justify-center cursor-pointer hover:bg-gray-100 transition-colors shadow-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(r){f(r);const e=URL.createObjectURL(r);h(e)}},className:"hidden"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-primary)"},children:"What's your name?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"First name",value:i,onChange:e=>n(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&i&&u&&!v&&E()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}}),e.jsx("input",{type:"text",placeholder:"Last name",value:c,onChange:e=>d(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&i&&u&&!v&&E()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-primary)"},children:"Choose a username"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-sm",style:{color:"var(--text-primary)"},children:"@"}),e.jsx("input",{type:"text",placeholder:"username",value:u,onChange:e=>{const t=e.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"");m(t.slice(0,20))},onKeyDown:e=>{"Enter"===e.key&&i&&u&&!v&&E()},maxLength:20,className:"w-full h-11 pl-10 pr-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}})]})]}),i&&u&&e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",style:{color:"#F2F4F7"},children:C}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:L})]}),y&&e.jsx("div",{className:"text-red-500 text-xs text-center",children:y}),e.jsx("button",{onClick:E,disabled:!i||!u||v,className:`\n                w-full h-11 rounded-lg font-semibold transition-all duration-300\n                ${i&&u&&!v?"hover:opacity-95":"opacity-50 cursor-not-allowed"}\n              `,style:{background:i&&u&&!v?"#E8E8E8":"rgba(75, 85, 99, 1)",color:i&&u&&!v?"#000000":"var(--text-primary)"},children:v?"Saving...":"Continue"})]})})]})]})}export{l as MakeProfilePage};

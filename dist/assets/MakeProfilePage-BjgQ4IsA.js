import{j as e}from"./spline-DN92G9fQ.js";import{u as t,r as s}from"./react-vendor-C5CBPnGl.js";import{s as r}from"./index-DwL-2SC4.js";import"./supabase-CAOwvaCC.js";function a(){const a=t(),[l,o]=s.useState(""),[i,n]=s.useState(""),[c,d]=s.useState(""),[u,m]=s.useState(null),[p,x]=s.useState(null),[h,f]=s.useState(!1),[g,v]=s.useState(null),[b,y]=s.useState(null),[w,j]=s.useState(!1),[N,F]=s.useState(window.innerWidth<640);s.useEffect(()=>{const e=setTimeout(()=>{j(!0)},100);return()=>clearTimeout(e)},[]),s.useEffect(()=>{const e=()=>F(window.innerWidth<640);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{(async()=>{const e=localStorage.getItem("verifiedUserId"),{data:{user:t}}=await r.auth.getUser(),s=(null==t?void 0:t.id)||e;if(s){const{data:e}=await r.from("users").select("user_type").eq("id",s).maybeSingle();e&&y(e.user_type)}})()},[]),s.useEffect(()=>{const e=localStorage.getItem("tempProfile");if(e)try{const t=JSON.parse(e);t.firstName&&o(t.firstName),t.lastName&&n(t.lastName),t.username&&d(t.username),t.profilePicture&&x(t.profilePicture)}catch(t){}},[]);const k=async()=>{if(l&&c){f(!0),v(null);try{const{data:{user:t},error:s}=await r.auth.getUser(),o=localStorage.getItem("verifiedUserId"),n=localStorage.getItem("verifiedEmail"),d=(null==t?void 0:t.id)||o;if(!d)return v(n?"User ID not found. Please try signing up again or contact support.":"Please complete sign-up first. Go back to sign up page."),void f(!1);let m=null;if(u)try{const e=new FileReader;m=await new Promise((t,s)=>{e.onload=()=>{const s=e.result.split(",")[1];t(s)},e.onerror=s,e.readAsDataURL(u)})}catch(e){return v(`Failed to process profile picture: ${e.message}`),void f(!1)}const x="https://hlcpoqxzqgbghsadouef.supabase.co/functions/v1/save-profile",h=await fetch(x,{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhsY3BvcXh6cWdiZ2hzYWRvdWVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzI2MTUsImV4cCI6MjA4MTcwODYxNX0.Qhbzj0g5FbpW0wgtGsJBF2AV0HqL-9X2S2nGL64KCYA","Content-Type":"application/json"},body:JSON.stringify({userId:d,firstName:l,lastName:i,username:c,userType:b||"creator",profilePictureBase64:m,profilePictureFileName:(null==u?void 0:u.name)||null})}),g=await h.json();if(!g.success)throw new Error(g.message||"Failed to save profile");localStorage.setItem("tempProfile",JSON.stringify({firstName:l,lastName:i,username:c,profilePicture:p})),a("/tell-us-about-yourself")}catch(t){v(t.message||"Failed to save profile"),f(!1)}}else v("Please fill in all required fields")},C=l&&i?`${l} ${i}`:l||"Your name",I=c?`@${c}`:"@username";return e.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center relative overflow-hidden py-8 sm:py-12 px-6",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E\")"},children:[e.jsxs("button",{onClick:()=>a("/"),className:"fixed top-6 left-6 z-50 flex items-center gap-1.5 text-gray-400 hover:text-white transition-colors group",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Home"})]}),!N&&e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none transition-opacity duration-700 ease-out overflow-hidden",style:{opacity:w?1:0,transform:"translateX(30%) scale(1.035)"},children:e.jsx("spline-viewer",{url:"https://prod.spline.design/hxB6DGH8u6Rcpq21/scene.splinecode","mouse-controls":"false",className:"spline-viewer-no-watermark"})}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm flex flex-col items-center",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-3",style:{color:"#F2F4F7"},children:"Make your profile"}),e.jsx("p",{className:"text-sm",style:{color:"#9CA3AF"},children:"Create your unique identity on Elevate"})]}),e.jsx("div",{className:"w-full p-6 relative overflow-hidden",style:{background:"rgba(10, 10, 15, 0.65)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",border:"1px solid rgba(255, 255, 255, 0.06)",borderRadius:"16px",boxShadow:"0 24px 48px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.03)"},children:e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center overflow-hidden border-2 border-white/10",children:p?e.jsx("img",{src:p,alt:"Profile preview",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsxs("label",{className:"absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full flex items-center justify-center cursor-pointer hover:bg-gray-100 transition-colors shadow-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){m(s);const e=URL.createObjectURL(s);x(e)}},className:"hidden"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"#9CA3AF"},children:"What's your name?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"First name",value:l,onChange:e=>o(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&l&&c&&!h&&k()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}}),e.jsx("input",{type:"text",placeholder:"Last name",value:i,onChange:e=>n(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&l&&c&&!h&&k()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"#9CA3AF"},children:"Choose a username"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-sm",style:{color:"#9CA3AF"},children:"@"}),e.jsx("input",{type:"text",placeholder:"username",value:c,onChange:e=>{const t=e.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"");d(t.slice(0,20))},onKeyDown:e=>{"Enter"===e.key&&l&&c&&!h&&k()},maxLength:20,className:"w-full h-11 pl-10 pr-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"}})]})]}),l&&c&&e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",style:{color:"#F2F4F7"},children:C}),e.jsx("p",{className:"text-sm",style:{color:"#9CA3AF"},children:I})]}),g&&e.jsx("div",{className:"text-red-500 text-xs text-center",children:g}),e.jsx("button",{onClick:k,disabled:!l||!c||h,className:`\n                w-full h-11 rounded-lg font-semibold transition-all duration-300\n                ${l&&c&&!h?"hover:opacity-95":"opacity-50 cursor-not-allowed"}\n              `,style:{background:l&&c&&!h?"#E8E8E8":"rgba(75, 85, 99, 1)",color:l&&c&&!h?"#000000":"#9CA3AF"},children:h?"Saving...":"Continue"})]})})]})]})}export{a as MakeProfilePage};

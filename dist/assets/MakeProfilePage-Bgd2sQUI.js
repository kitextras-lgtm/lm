import{j as e}from"./spline-C1bWgT9i.js";import{u as t,d as s,r}from"./react-vendor-D-1Z2fag.js";import{s as a}from"./index-DPBRF2P4.js";import"./supabase-Dexhd8Ad.js";function l(){const l=t(),o=s(),[i,n]=r.useState(""),[c,u]=r.useState(""),[d,m]=r.useState(""),[p,f]=r.useState(null),[x,h]=r.useState(null),[g,v]=r.useState(!1),[y,b]=r.useState(null),[w,j]=r.useState(null),[N,k]=r.useState(!1),[F,I]=r.useState(window.innerWidth<640);r.useEffect(()=>{const e=setTimeout(()=>{k(!0)},100);return()=>clearTimeout(e)},[]),r.useEffect(()=>{const e=()=>I(window.innerWidth<640);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),r.useEffect(()=>{var e,t,s;if("artist"===(null==(e=o.state)?void 0:e.userType))return void j("artist");if("freelancer"===(null==(t=o.state)?void 0:t.userType))return void j("freelancer");if("business"===(null==(s=o.state)?void 0:s.userType))return void j("business");(async()=>{const e=localStorage.getItem("verifiedUserId"),{data:{user:t}}=await a.auth.getUser(),s=(null==t?void 0:t.id)||e;if(s){const{data:e}=await a.from("users").select("user_type").eq("id",s).maybeSingle();e&&j(e.user_type)}})()},[o.state]),r.useEffect(()=>{const e=localStorage.getItem("tempProfile");if(e)try{const t=JSON.parse(e);t.firstName&&n(t.firstName),t.lastName&&u(t.lastName),t.username&&m(t.username),t.profilePicture&&h(t.profilePicture)}catch(t){}},[]);const S=async()=>{var e,t,s;if(i&&d){v(!0),b(null);try{const{data:{user:n}}=await a.auth.getUser(),u=localStorage.getItem("verifiedUserId"),m=localStorage.getItem("verifiedEmail"),f=(null==n?void 0:n.id)||u;if(!f)return b(m?"User ID not found. Please try signing up again or contact support.":"Please complete sign-up first. Go back to sign up page."),void v(!1);let h=null;if(p)try{const e=new FileReader;h=await new Promise((t,s)=>{e.onload=()=>{const s=e.result.split(",")[1];t(s)},e.onerror=s,e.readAsDataURL(p)})}catch(r){return b(`Failed to process profile picture: ${r.message}`),void v(!1)}const g="https://hlcpoqxzqgbghsadouef.supabase.co/functions/v1/save-profile",y=await fetch(g,{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhsY3BvcXh6cWdiZ2hzYWRvdWVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzI2MTUsImV4cCI6MjA4MTcwODYxNX0.Qhbzj0g5FbpW0wgtGsJBF2AV0HqL-9X2S2nGL64KCYA","Content-Type":"application/json"},body:JSON.stringify({userId:f,firstName:i,lastName:c,username:d,email:localStorage.getItem("verifiedEmail"),...w&&{userType:w},profilePictureBase64:h,profilePictureFileName:(null==p?void 0:p.name)||null})}),j=await y.json();if(!j.success)throw new Error(j.message||"Failed to save profile");const N={firstName:i,lastName:c,username:d,profilePicture:x,userType:w};localStorage.setItem("tempProfile",JSON.stringify(N)),"artist"===w||"artist"===(null==(e=o.state)?void 0:e.userType)?l("/tell-us-about-yourself",{state:{userType:"artist"}}):"freelancer"===w||"freelancer"===(null==(t=o.state)?void 0:t.userType)?l("/tell-us-about-yourself",{state:{userType:"freelancer"}}):"business"===w||"business"===(null==(s=o.state)?void 0:s.userType)?l("/tell-us-about-yourself",{state:{userType:"business"}}):l("/tell-us-about-yourself")}catch(n){b(n.message||"Failed to save profile"),v(!1)}}else b("Please fill in all required fields")},C=i&&c?`${i} ${c}`:i||"Your name",E=d?`@${d}`:"@username";return e.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center relative overflow-hidden py-8 sm:py-12 px-6",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E\")"},children:[e.jsxs("button",{onClick:()=>{const e="artist"===new URLSearchParams(window.location.search).get("source");localStorage.removeItem("verifiedUserId"),localStorage.removeItem("verifiedEmail"),localStorage.removeItem("tempProfile"),l(e?"/learn/artist":"/signup")},className:"fixed top-6 left-6 z-50 flex items-center gap-1.5 text-gray-400 hover:text-white transition-colors group",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"text-xs font-medium",children:"Back"})]}),!F&&e.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none transition-opacity duration-700 ease-out overflow-hidden",style:{opacity:N?1:0,transform:"translateX(30%) scale(1.035)"},children:e.jsx("spline-viewer",{url:"https://prod.spline.design/hxB6DGH8u6Rcpq21/scene.splinecode","mouse-controls":"false",className:"spline-viewer-no-watermark"})}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm flex flex-col items-center",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-3",style:{color:"#F2F4F7"},children:"Make your profile"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:"Create your unique identity on Elevate"})]}),e.jsx("div",{className:"w-full p-6 relative overflow-hidden",style:{background:"rgba(10, 10, 15, 0.65)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",border:"1px solid rgba(255, 255, 255, 0.06)",borderRadius:"16px",boxShadow:"0 24px 48px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.03)"},children:e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center overflow-hidden border-2 border-white/10",children:x?e.jsx("img",{src:x,alt:"Profile preview",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsxs("label",{className:"absolute bottom-0 right-0 w-8 h-8 bg-white rounded-full flex items-center justify-center cursor-pointer hover:bg-gray-100 transition-colors shadow-lg",children:[e.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){f(s);const e=URL.createObjectURL(s);h(e)}},className:"hidden"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-primary)"},children:"What's your name?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"First name",value:i,onChange:e=>n(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&i&&d&&!g&&S()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"},onFocus:e=>{e.target.style.border="1px solid #ffffff"},onBlur:e=>{e.target.style.border="1px solid rgba(75, 85, 99, 1)"}}),e.jsx("input",{type:"text",placeholder:"Last name",value:c,onChange:e=>u(e.target.value.slice(0,15)),onKeyDown:e=>{"Enter"===e.key&&i&&d&&!g&&S()},maxLength:15,className:"flex-1 min-w-0 h-11 px-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"},onFocus:e=>{e.target.style.border="1px solid #ffffff"},onBlur:e=>{e.target.style.border="1px solid rgba(75, 85, 99, 1)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-primary)"},children:"Choose a username"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-sm",style:{color:"var(--text-primary)"},children:"@"}),e.jsx("input",{type:"text",placeholder:"username",value:d,onChange:e=>{const t=e.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"");m(t.slice(0,20))},onKeyDown:e=>{"Enter"===e.key&&i&&d&&!g&&S()},maxLength:20,className:"w-full h-11 pl-10 pr-4 rounded-lg text-sm focus:outline-none transition-all",style:{color:"#F2F4F7",background:"transparent",border:"1px solid rgba(75, 85, 99, 1)"},onFocus:e=>{e.target.style.border="1px solid #ffffff"},onBlur:e=>{e.target.style.border="1px solid rgba(75, 85, 99, 1)"}})]})]}),i&&d&&e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",style:{color:"#F2F4F7"},children:C}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-primary)"},children:E})]}),y&&e.jsx("div",{className:"text-red-500 text-xs text-center",children:y}),e.jsx("button",{onClick:S,disabled:!i||!d||g,className:`\n                w-full h-11 rounded-lg font-semibold transition-all duration-300\n                ${i&&d&&!g?"hover:opacity-95":"opacity-50 cursor-not-allowed"}\n              `,style:{background:i&&d&&!g?"#E8E8E8":"rgba(75, 85, 99, 1)",color:i&&d&&!g?"#000000":"var(--text-primary)"},children:g?"Saving...":"Continue"})]})})]})]})}export{l as MakeProfilePage};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-evv0E1mA.js","assets/spline-DN92G9fQ.js","assets/react-vendor-C5CBPnGl.js","assets/supabase-CAOwvaCC.js","assets/index-DpGjbtbi.css"])))=>i.map(i=>d[i]);
import{c as e}from"./createLucideIcon-DApH4y_Q.js";import{_ as t,j as s}from"./spline-DN92G9fQ.js";import{r as n}from"./react-vendor-C5CBPnGl.js";import{A as r}from"./arrow-left-D6ZoFILw.js";import{s as a,g as l,p as i}from"./index-evv0E1mA.js";import{C as o}from"./chevron-down-BtUUkoj_.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c=e("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),d=e("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),u=e("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),m=e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),x=e("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),h=e("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),p=e("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),g=e("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),f=e("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),y=e("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),v=e("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),w=e("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),b=e("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),j=e("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),k="messages_cache_";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function _(e){try{const t=localStorage.getItem(k+e);if(t){const s=JSON.parse(t);if("1"!==s.version)return null;return Date.now()-s.timestamp>3e5?(localStorage.removeItem(k+e),null):s.messages||null}}catch(t){}return null}function N(e,t){try{const s={messages:t,timestamp:Date.now(),version:"1"};localStorage.setItem(k+e,JSON.stringify(s))}catch(s){}}const C="conversations_cache";function F(e){try{const t=sessionStorage.getItem(C);if(t){const s=JSON.parse(t);if("1"!==s.version||s.customerId!==e)return null;return Date.now()-s.timestamp>6e5?(sessionStorage.removeItem(C),null):s.conversations||null}}catch(t){}return null}function S(e){const[s,r]=n.useState(()=>{if("undefined"!=typeof window&&e){return F(e)||[]}return[]}),[l,i]=n.useState(()=>{if("undefined"!=typeof window&&e){const t=F(e);return!t||0===t.length}return!0}),o=n.useCallback((e,t)=>{r(s=>s.map(s=>s.id===e?{...s,unread_count_customer:t}:s))},[]),c=n.useCallback(async()=>{if(!e)return r([]),void i(!1);const{data:s,error:n}=await a.from("conversations").select("\n        *,\n        admin:profiles!conversations_admin_id_fkey(*)\n      ").eq("customer_id",e).order("last_message_at",{ascending:!1});if(!n&&s){const a=s;a.forEach((e,t)=>{e.admin});a.reduce((e,t)=>e+(t.unread_count_customer||0),0);r([...a]),function(e,t){try{const s={conversations:t,timestamp:Date.now(),version:"1",customerId:e};sessionStorage.setItem(C,JSON.stringify(s))}catch(n){}}(e,a),a.forEach(e=>{var s;(null==(s=e.admin)?void 0:s.avatar_url)&&t(async()=>{const{preloadAndCacheImage:e}=await import("./index-evv0E1mA.js").then(e=>e.i);return{preloadAndCacheImage:e}},__vite__mapDeps([0,1,2,3,4])).then(({preloadAndCacheImage:t})=>{t(e.admin.avatar_url)})})}i(!1)},[e]);return n.useEffect(()=>{if(!e)return r([]),void i(!1);const t=F(e);t&&t.length>0&&(r(t),i(!1)),c();const s=a.channel(`customer-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`customer_id=eq.${e}`},e=>{const t=e.new;e.old;if("UPDATE"===e.eventType&&(null==t?void 0:t.id)){const e=t;return void r(t=>{const s=t.findIndex(t=>t.id===e.id);if(s>=0){const n=[...t],r=t[s].admin;n[s]={...e,admin:r};n.reduce((e,t)=>e+(t.unread_count_customer||0),0);return n}return t})}c()}).subscribe(e=>{});return()=>{s.unsubscribe()}},[e,c]),{conversations:s,loading:l,updateConversationUnreadCount:o,refetch:c}}function B(e){const[t,s]=n.useState(null),[r,l]=n.useState(!0);return n.useEffect(()=>{(async()=>{const{data:t,error:n}=await a.from("profiles").select("*").eq("id",e).maybeSingle();!n&&t&&s(t),l(!1)})();const t=a.channel(`profile:${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${e}`},e=>{s(e.new)}).subscribe();return()=>{t.unsubscribe()}},[e]),{profile:t,loading:r}}function E(e){n.useEffect(()=>{const t=async t=>{await a.from("profiles").update({is_online:t,last_seen:(new Date).toISOString()}).eq("id",e)};t(!0);const s=()=>{t(!document.hidden)},n=()=>{t(!1)};return document.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",n),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("beforeunload",n),t(!1)}},[e])}async function T(){try{const{data:e,error:t}=await a.from("profiles").select("id, name, is_admin").eq("is_admin",!0).limit(1).maybeSingle();if(t)return null;if(!e){const{data:e,error:t}=await a.from("profiles").select("id, name, is_admin, email").limit(10);if(t);else{((null==e?void 0:e.filter(e=>!0===e.is_admin))||[]).length}return null}return e.id}catch(e){return null}}async function M(e){var t,s,n,r,l,i;try{const{data:o,error:c}=await a.from("profiles").select("id").eq("id",e).maybeSingle();if(c)return null;if(!o){const{data:s,error:n}=await a.from("users").select("email, first_name, last_name, full_name").eq("id",e).maybeSingle();if(n)return null;const r=(null==s?void 0:s.full_name)||((null==s?void 0:s.first_name)&&(null==s?void 0:s.last_name)?`${s.first_name} ${s.last_name}`.trim():null)||(null==(t=null==s?void 0:s.email)?void 0:t.split("@")[0])||"User",{error:l}=await a.from("profiles").insert({id:e,name:r,avatar_url:"",is_admin:!1,is_online:!1});if(l)return null}const d=await T();if(!d)return null;const{data:u,error:m}=await a.from("conversations").select("*").eq("customer_id",e).eq("admin_id",d).maybeSingle();if(m&&"PGRST116"!==m.code)return null;if(u){const{data:e,error:t}=await a.from("profiles").select("*").eq("id",d).single();return t?null:e?{...u,admin:e}:null}const{data:x,error:h}=await a.from("conversations").insert({customer_id:e,admin_id:d,last_message:"",unread_count_admin:0,unread_count_customer:0}).select("*").single();if(h){if("23505"===h.code||"409"===h.code||"PGRST204"===h.code||(null==(s=h.message)?void 0:s.toLowerCase().includes("duplicate"))||(null==(n=h.message)?void 0:n.toLowerCase().includes("unique"))||(null==(r=h.message)?void 0:r.toLowerCase().includes("conflict"))||(null==(l=h.message)?void 0:l.toLowerCase().includes("already exists"))){const{data:t,error:s}=await a.from("conversations").select("*").eq("customer_id",e).eq("admin_id",d).maybeSingle();if(s)return null;if(t){const{data:e,error:s}=await a.from("profiles").select("*").eq("id",d).single();if(s)return null;if(e)return{...t,admin:e}}}return null}const{data:p}=await a.from("users").select("first_name").eq("id",e).maybeSingle(),g=(null==(i=null==p?void 0:p.first_name)?void 0:i.trim())||"",f=`Hi${g?` ${g},`:""} welcome to Elevate! ðŸ‘‹\n\nIf you have any questions, feel free to ask.\n\nHave suggestions or feedback? You can submit them here. We review everything and are always working to give you the best experience on Elevate.`,{error:y}=await a.from("messages").insert({conversation_id:x.id,sender_id:d,type:"text",content:f,status:"sent"});if(y);else{const e=f.split("\n")[0];await a.from("conversations").update({last_message:e,last_message_at:(new Date).toISOString(),last_message_sender_id:d,unread_count_customer:1}).eq("id",x.id)}const{data:v,error:w}=await a.from("profiles").select("*").eq("id",d).single();if(w)return null;if(v&&x){return{...x,admin:v}}return null}catch(o){return null}}function A(e){const[s,r]=n.useState([]),[l,i]=n.useState(!0),o=n.useRef(!1);return n.useEffect(()=>{if(!e)return r([]),void i(!1);const s=async()=>{o.current||i(!0);const{data:s,error:n}=await a.from("conversations").select("*").eq("admin_id",e);if(n)return r([]),i(!1),void(o.current=!0);if(!s||0===s.length)return r([]),i(!1),void(o.current=!0);const l=[...new Set(s.map(e=>e.customer_id))],c=s.map(e=>e.id),{data:d,error:u}=await a.from("profiles").select("*").in("id",l);if(u)return r([]),i(!1),void(o.current=!0);const{data:m,error:x}=await a.from("messages").select("conversation_id, created_at, sender_id").in("conversation_id",c).order("created_at",{ascending:!1}),h=new Map;if(m)for(const e of m){const t=s.find(t=>t.id===e.conversation_id);t&&e.sender_id===t.customer_id&&(h.has(e.conversation_id)||h.set(e.conversation_id,e.created_at))}const p=new Map((d||[]).map(e=>[e.id,e])),g=s.map(e=>({...e,customer:p.get(e.customer_id)||null,last_customer_message_at:h.get(e.id)||e.last_message_at})).filter(e=>null!==e.customer);g.forEach(e=>{var s;(null==(s=e.customer)?void 0:s.avatar_url)&&t(async()=>{const{preloadAndCacheImage:e}=await import("./index-evv0E1mA.js").then(e=>e.i);return{preloadAndCacheImage:e}},__vite__mapDeps([0,1,2,3,4])).then(({preloadAndCacheImage:t})=>{t(e.customer.avatar_url)})}),g.sort((e,t)=>{const s=h.has(e.id),n=h.has(t.id);if(s&&!n)return-1;if(!s&&n)return 1;const r=e.last_customer_message_at?new Date(e.last_customer_message_at).getTime():e.last_message_at?new Date(e.last_message_at).getTime():0;return(t.last_customer_message_at?new Date(t.last_customer_message_at).getTime():t.last_message_at?new Date(t.last_message_at).getTime():0)-r}),r(g),i(!1),o.current=!0};s();const n=a.channel(`admin-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`admin_id=eq.${e}`},()=>{s()}).subscribe();return()=>{n.unsubscribe()}},[e]),{conversations:s,loading:l}}function L(e){const t=new Date(e),s=new Date,n=s.getTime()-t.getTime(),r=Math.floor(n/864e5);return 0===r?"Today":1===r?"Yesterday":r<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==s.getFullYear()?"numeric":void 0})}function R(e){const t=new Date(e),s=(new Date).getTime()-t.getTime(),n=Math.floor(s/864e5);return 0===n?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):1===n?"Yesterday":n<7?t.toLocaleDateString("en-US",{weekday:"short"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const I=n.memo(function({conversation:e,otherUser:t,currentUserId:r,getSenderName:l,onMarkAsRead:i}){const{messages:o,loading:c,otherUserTyping:d,sendMessage:u,setTyping:m,markMessagesAsSeen:x}=function({conversationId:e,currentUserId:t}){const[s,r]=n.useState(()=>"undefined"!=typeof window&&_(e)||[]),[l,i]=n.useState(()=>{if("undefined"!=typeof window){const t=_(e);return!t||0===t.length}return!0}),[o,c]=n.useState(!1),d=n.useRef(null),u=n.useCallback(async()=>{if(e)try{const{data:t,error:s}=await a.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(s)return void i(!1);if(t){const s=t;r(s),N(e,s)}}catch(t){}finally{i(!1)}else i(!1)},[e]);return n.useEffect(()=>{if(!e)return;const s=_(e);s&&s.length>0?(r(s),i(!1)):(r([]),i(!0)),u();const n=a.channel(`messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},t=>{const s=t.new;r(t=>{if(t.some(e=>e.id===s.id))return t;const n=[...t,s];return N(e,n),n})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},t=>{const s=t.new;r(t=>{const n=t.map(e=>e.id===s.id?s:e);return N(e,n),n})}).subscribe(),l=a.channel(`typing:${e}`).on("broadcast",{event:"typing"},({payload:e})=>{e.userId!==t&&c(e.isTyping)}).subscribe();return d.current=l,()=>{n.unsubscribe(),l.unsubscribe()}},[e,t,u]),{messages:s,loading:l,otherUserTyping:o,sendMessage:n.useCallback(async(s,n,r)=>{const l=n?"image":"text",{data:i,error:o}=await a.from("messages").insert({conversation_id:e,sender_id:t,type:l,content:s||"",image_url:n||"",status:"sent",reply_to_id:(null==r?void 0:r.id)||null,reply_to_sender_name:(null==r?void 0:r.senderName)||"",reply_to_content:(null==r?void 0:r.content)||""}).select().single();if(o)return{data:null,error:o};if(i){const{data:n}=await a.from("conversations").select("customer_id, admin_id, unread_count_admin, unread_count_customer").eq("id",e).single();if(n){const r=n.customer_id===t;let l=s||"Sent an image";"Sent an image"!==l&&(l=l.replace(/\n/g," ").trim(),l.startsWith("Me: ")&&(l=l.substring(4).trim()),l.length>80&&(l=l.substring(0,80)+"..."));const i={last_message:l,last_message_at:(new Date).toISOString(),last_message_sender_id:t};if(r)i.unread_count_customer=0,i.unread_count_admin=(n.unread_count_admin||0)+1;else{i.unread_count_admin=0;const e=n.unread_count_customer||0;i.unread_count_customer=e+1}const{error:o}=await a.from("conversations").update(i).eq("id",e)}}return{data:i,error:null}},[e,t]),setTyping:n.useCallback(e=>{var s;null==(s=d.current)||s.send({type:"broadcast",event:"typing",payload:{userId:t,isTyping:e}})},[t]),markMessagesAsSeen:n.useCallback(async()=>{const{data:s}=await a.from("conversations").select("customer_id, admin_id").eq("id",e).single();if(s){const n=s.customer_id===t;await a.from("messages").update({status:"seen"}).eq("conversation_id",e).neq("sender_id",t).neq("status","seen");const r={};n?r.unread_count_customer=0:r.unread_count_admin=0;const{data:l,error:i}=await a.from("conversations").update(r).eq("id",e).select().single()}},[e,t])}}({conversationId:e.id,currentUserId:r}),{uploadImage:h,uploading:p}=function(){const[e,t]=n.useState(!1);return{uploadImage:async e=>{var s;t(!0);try{const t=new FormData;t.append("image",e);const n=await fetch("https://api.imgbb.com/1/upload?key=012774bd056a91a1055131cf67c1a486",{method:"POST",body:t});if(n.ok){const e=await n.json();if(null==(s=e.data)?void 0:s.url)return e.data.url}const r=new FileReader;return new Promise((t,s)=>{r.onerror=()=>{s(new Error("Failed to read image"))},r.onloadend=()=>{t(r.result)},r.readAsDataURL(e)})}catch(n){const t=new FileReader;return new Promise((s,n)=>{t.onerror=()=>{n(new Error("Failed to read image"))},t.onloadend=()=>{s(t.result)},t.readAsDataURL(e)})}finally{t(!1)}},uploading:e}}(),g=n.useRef(null),f=n.useRef(null),[y,v]=n.useState(null),[w,b]=n.useState(!1),j=n.useRef(null),k=n.useRef(!1),C=n.useRef(!0),F=n.useRef(!0),[S,B]=n.useState(!1),E=n.useRef({}),T=n.useMemo(()=>o.filter(e=>"image"===e.type&&e.image_url),[o]);n.useEffect(()=>{C.current=!0,F.current=!0,B(!1),E.current={}},[e.id]),n.useEffect(()=>{if(!c&&o.length>0){if(0===T.length)return void B(!0);T.every(e=>!0===E.current[e.id])&&B(!0)}else c||0!==o.length||B(!0)},[c,o.length,T]);const M=n.useCallback((e,t)=>{E.current[e]=t;T.every(e=>!0===E.current[e.id])&&!c&&B(!0)},[T,c]);n.useEffect(()=>{!c&&o.length>0&&g.current&&F.current&&S&&(g.current.scrollIntoView({behavior:C.current?"instant":"smooth"}),C.current&&(C.current=!1))},[c,o.length,e.id,S]),n.useEffect(()=>(k.current=!1,()=>{k.current=!1}),[e.id]),n.useEffect(()=>{o.length>0&&!k.current&&x().then(()=>{k.current=!0,i&&i(e.id)})},[e.id,o.length,x,i]),n.useEffect(()=>{if(o.length>0&&f.current){j.current&&clearTimeout(j.current);const t=f.current;return t.scrollHeight-t.scrollTop<=t.clientHeight+100&&(j.current=setTimeout(()=>{x().then(()=>{i&&i(e.id)})},2e3)),()=>{j.current&&clearTimeout(j.current)}}},[o.length,x,e.id,i]);const A=n.useCallback(e=>{v(e)},[]),R=n.useCallback(()=>{v(null)},[]),I=n.useCallback(e=>{const t=document.getElementById(`message-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-neutral-700/30"),setTimeout(()=>{t.classList.remove("bg-neutral-700/30")},1500))},[]);return s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 min-w-0 overflow-hidden",style:{backgroundColor:"#111111",height:"100%"},children:[s.jsx(Y,{user:t,isTyping:d,onVideoCall:()=>{},onScheduleMeeting:()=>{},onOpenDrawer:()=>b(!0)}),s.jsxs("div",{className:"flex-1 min-h-0 relative",children:[!S&&s.jsx("div",{className:"absolute inset-0 z-10 flex flex-col",style:{backgroundColor:"#111111",transition:"opacity 150ms ease-out",opacity:S?0:1,pointerEvents:S?"none":"auto"},children:s.jsx("div",{className:"flex-1 py-2 lg:py-4 flex flex-col justify-end animate-pulse",children:s.jsxs("div",{className:"space-y-0.5 lg:space-y-1 px-2 lg:px-4",children:[s.jsx("div",{className:"flex justify-start px-2 lg:px-4 py-0.5",children:s.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%]",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(75, 85, 99, 0.15)",minHeight:"2.5rem",width:"180px"}}),s.jsx("div",{className:"h-3 rounded px-1",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})}),s.jsx("div",{className:"flex justify-end px-2 lg:px-4 py-0.5",children:s.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%] flex-row-reverse",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(248, 250, 252, 0.1)",minHeight:"2.5rem",width:"140px"}}),s.jsx("div",{className:"h-3 rounded px-1 ml-auto",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})}),s.jsx("div",{className:"flex justify-start px-2 lg:px-4 py-0.5",children:s.jsx("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%]",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"rounded-2xl px-4 py-3",style:{backgroundColor:"rgba(75, 85, 99, 0.15)",minHeight:"3.5rem",width:"220px"}}),s.jsx("div",{className:"h-3 rounded px-1",style:{backgroundColor:"rgba(75, 85, 99, 0.1)",width:"40px"}})]})})})]})})}),s.jsx("div",{ref:f,className:"absolute inset-0 overflow-y-auto",style:{backgroundColor:"#111111",scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.3) transparent",overflowY:"auto",opacity:S?1:0,transition:"opacity 150ms ease-in"},onScroll:()=>{if(f.current){const t=f.current,s=t.scrollHeight-t.scrollTop<=t.clientHeight+50;F.current=s,s&&o.length>0&&(j.current&&clearTimeout(j.current),x().then(()=>{i&&i(e.id)}))}},children:s.jsxs("div",{className:"py-2 lg:py-4 min-h-full flex flex-col justify-end",children:[0!==o.length||c?s.jsx("div",{className:"space-y-0.5 lg:space-y-1 px-2 lg:px-2 "+(S?"chat-content-ready":"chat-content-loading"),children:o.map((e,t)=>{const n=t>0?o[t-1]:null,a=new Date(e.created_at),i=n?new Date(n.created_at):null,c=!(i&&(d=a,u=i,d.getFullYear()===u.getFullYear()&&d.getMonth()===u.getMonth()&&d.getDate()===u.getDate()));var d,u;return s.jsxs("div",{children:[c&&s.jsx("div",{className:"flex items-center justify-center py-5",children:s.jsx("div",{className:"px-3 py-1.5 rounded-lg",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.15)"},children:s.jsx("span",{className:"text-xs font-medium",style:{color:"#94A3B8"},children:L(e.created_at)})})}),s.jsx(J,{message:e,isOwn:e.sender_id===r,onReply:A,onScrollToMessage:I,senderName:l(e.sender_id),onImageLoad:M})]},e.id)})}):s.jsx("div",{className:"flex-1 flex items-center justify-center",children:s.jsxs("div",{className:"text-center px-4 lg:px-6",children:[s.jsx("div",{className:"w-16 h-16 lg:w-20 lg:h-20 mx-auto mb-4 lg:mb-5 rounded-xl lg:rounded-2xl flex items-center justify-center",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.1)"},children:s.jsx("svg",{className:"w-8 h-8 lg:w-10 lg:h-10",style:{color:"#64748B"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),s.jsx("p",{className:"text-xs lg:text-sm font-medium",style:{color:"#94A3B8"},children:"No messages yet"}),s.jsx("p",{className:"text-[10px] lg:text-xs mt-1",style:{color:"#64748B"},children:"Start the conversation by sending a message"})]})}),d&&s.jsx(te,{}),s.jsx("div",{ref:g})]})})]}),s.jsx($,{onSendMessage:async(t,s,n)=>{v(null),F.current=!0;try{let r;if(s&&(r=await h(s)||void 0,!r))throw new Error("Failed to upload image");const a=await u(t,r,n);if(null==a?void 0:a.error)throw a.error;i&&i(e.id)}catch(r){}},onTyping:m,disabled:p,replyTo:y,onCancelReply:R,otherUserName:t.name}),s.jsx(ne,{isOpen:w,onClose:()=>b(!1),user:t})]})});function D({file:e,onRemove:t}){const[r,a]=n.useState("");return n.useEffect(()=>{const t=URL.createObjectURL(e);return a(t),()=>{URL.revokeObjectURL(t)}},[e]),s.jsxs("div",{className:"relative inline-block",children:[s.jsx("img",{src:r,alt:"Upload preview",className:"w-20 h-20 object-cover rounded-lg",style:{border:"1px solid rgba(75, 85, 99, 0.2)"}}),s.jsx("button",{onClick:t,className:"absolute -top-2 -right-2 p-1 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:s.jsx(j,{className:"w-3.5 h-3.5",style:{color:"#F8FAFC"}})})]})}function q({replyTo:e,onCancel:t}){const n=e.content.length>80?e.content.substring(0,80)+"...":e.content;return s.jsx("div",{className:"animate-fade-in",children:s.jsxs("div",{className:"flex items-start gap-3 px-3 py-2 rounded-lg border-l-2",style:{backgroundColor:"#1a1a1e",borderColor:"#64748B"},children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("p",{className:"text-xs font-medium",style:{color:"#F8FAFC"},children:["Replying to ",e.senderName]}),s.jsx("p",{className:"text-xs truncate mt-0.5",style:{color:"#94A3B8"},children:n||"Image"})]}),s.jsx("button",{onClick:t,className:"shrink-0 p-1 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:s.jsx(j,{className:"w-4 h-4"})})]})})}const O=10485760,U=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];function $({onSendMessage:e,onTyping:t,disabled:r,replyTo:a,onCancelReply:l,otherUserName:i}){const[o,d]=n.useState(""),[u,m]=n.useState(null),x=n.useRef(null),h=n.useRef(null),g=n.useRef(null),f=n.useRef(null),y=n.useRef(null);n.useEffect(()=>{const e=h.current;if(e){e.style.height="36px";const t=e.scrollHeight;t>36&&(e.style.height=`${Math.min(t,150)}px`)}},[o]),n.useEffect(()=>{a&&h.current&&h.current.focus()},[a]),n.useEffect(()=>{g.current&&(g.current.style.borderRadius="0"),f.current&&(f.current.style.borderRadius="0"),h.current&&(h.current.style.borderRadius="0")},[]);const v=()=>{!o.trim()&&!u||r||(e(o.trim(),u||void 0,a||void 0),d(""),m(null),t(!1),y.current&&clearTimeout(y.current))},w=n.useCallback(e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&U.includes(s.type)?(s.size>O||m(s),e.target.value=""):e.target.value=""},[]),j=o.trim()||u;return s.jsxs(s.Fragment,{children:[a&&l&&s.jsx("div",{className:"px-3 lg:px-4 pt-3",children:s.jsx(q,{replyTo:a,onCancel:l})}),u&&s.jsx("div",{className:"px-3 lg:px-4 py-2",children:s.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-3",style:{backgroundColor:"rgba(26, 26, 30, 0.5)"},children:[s.jsx(D,{file:u,onRemove:()=>m(null)}),u.size>O&&s.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"#ef4444"},children:[s.jsx(c,{className:"w-4 h-4"}),s.jsx("span",{children:"File too large"})]})]})}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),v()},className:"flex gap-2 items-center safe-area-inset-bottom",style:{borderTop:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"#111111",padding:"12px 16px"},children:[s.jsx("input",{type:"file",ref:x,onChange:w,accept:"image/*",className:"hidden"}),s.jsx("button",{ref:g,type:"button",onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},disabled:r,className:"shrink-0 hover:bg-transparent group h-8 w-8 flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"#94A3B8",borderRadius:0},children:s.jsx(p,{className:"w-4 h-4 transition-transform duration-200 group-hover:scale-125"})}),s.jsx("textarea",{ref:h,value:o,onChange:e=>{d(e.target.value),t(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{t(!1)},2e3)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},placeholder:i?`Message @${i}`:"Send a message...",disabled:r,rows:1,maxLength:5e3,"aria-label":"Message input",className:"flex-1 px-4 py-2 text-sm focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed resize-none overflow-y-auto",style:{minHeight:"32px",maxHeight:"120px",color:"#F8FAFC",backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)",borderRadius:0}}),s.jsx("button",{ref:f,type:"submit",disabled:!j||r,className:"shrink-0 h-8 w-8 flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed",style:j?{backgroundColor:"#F8FAFC",color:"#111111",borderRadius:0}:{backgroundColor:"rgba(148, 163, 184, 0.1)",color:"#94A3B8",borderRadius:0},children:s.jsx(b,{className:"w-4 h-4"})})]})]})}const z=`data:image/svg+xml;base64,${btoa('<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="avatarGradient" x1="0%" y1="0%" x2="100%" y2="100%">\n        <stop offset="0%" stop-color="#1e1e24"/>\n        <stop offset="100%" stop-color="#0f0f13"/>\n      </linearGradient>\n      <linearGradient id="avatarShine" x1="0%" y1="0%" x2="100%" y2="100%">\n        <stop offset="0%" stop-color="#64748B" stop-opacity="0.15"/>\n        <stop offset="100%" stop-color="#64748B" stop-opacity="0"/>\n      </linearGradient>\n    </defs>\n    <circle cx="20" cy="20" r="20" fill="url(#avatarGradient)"/>\n    <circle cx="20" cy="15" r="7" fill="#64748B" fill-opacity="0.8"/>\n    <path d="M8 32c0-5.523 4.477-10 10-10h4c5.523 0 10 4.477 10 10" stroke="#64748B" stroke-width="2.5" stroke-opacity="0.8" fill="none" stroke-linecap="round"/>\n    <circle cx="20" cy="20" r="20" fill="url(#avatarShine)"/>\n  </svg>')}`;btoa('<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect width="40" height="40" fill="#000000"/>\n    <g>\n      \x3c!-- Leftmost bar (shortest) --\x3e\n      <rect x="7" y="19" width="3" height="6" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Second bar (medium) --\x3e\n      <rect x="12" y="16" width="3" height="12" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Center bar (tallest) --\x3e\n      <rect x="17" y="8" width="3" height="24" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Fourth bar (medium) --\x3e\n      <rect x="22" y="16" width="3" height="12" rx="1.5" fill="#FFFFFF"/>\n      \x3c!-- Rightmost bar (shortest) --\x3e\n      <rect x="27" y="19" width="3" height="6" rx="1.5" fill="#FFFFFF"/>\n    </g>\n  </svg>');const P="https://hlcpoqxzqgbghsadouef.supabase.co/storage/v1/object/public/avatars/pic/elevate%20solid%20white%20logo%20ver.jpeg";function W({className:e,style:t}){const[r,a]=n.useState(!1);return s.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:t,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:s.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[s.jsx("rect",{x:"4",y:"14",width:"28",height:"20",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:r?"scale(1.05)":"scale(1)",transformOrigin:"18px 24px",transition:"transform 0.3s ease"}}),s.jsx("circle",{cx:"18",cy:"24",r:"6",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:r?"scale(1.1)":"scale(1)",transformOrigin:"18px 24px",transition:"transform 0.3s ease 0.05s"}}),s.jsx("circle",{cx:"18",cy:"24",r:"3",fill:"white",style:{opacity:r?.8:.4,transition:"opacity 0.3s ease"}}),s.jsx("circle",{cx:"16",cy:"22",r:"1",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.1s"}}),s.jsx("path",{d:"M32 18L44 12V36L32 30V18Z",stroke:"white",strokeWidth:"3",strokeLinejoin:"round",fill:"none",style:{transform:r?"translateX(2px) scale(1.1)":"translateX(0) scale(1)",transformOrigin:"32px 24px",transition:"transform 0.3s ease"}}),s.jsx("circle",{cx:"8",cy:"18",r:"2",fill:"#ef4444",style:{opacity:r?1:0,transform:r?"scale(1)":"scale(0)",transformOrigin:"8px 18px",transition:"all 0.3s ease"}}),s.jsx("circle",{cx:"8",cy:"18",r:"2",fill:"#ef4444",style:{opacity:r?.3:0,transform:r?"scale(2.5)":"scale(0)",transformOrigin:"8px 18px",transition:"all 0.5s ease"}})]})})}function H({className:e,style:t}){const[r,a]=n.useState(!1);return s.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:t,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:s.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[s.jsx("rect",{x:"6",y:"10",width:"36",height:"32",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:r?"scale(1.05)":"scale(1)",transformOrigin:"24px 26px",transition:"transform 0.3s ease"}}),s.jsx("line",{x1:"6",y1:"18",x2:"42",y2:"18",stroke:"white",strokeWidth:"3",style:{opacity:r?.8:.6,transition:"opacity 0.3s ease"}}),s.jsx("line",{x1:"14",y1:"6",x2:"14",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{transform:r?"translateY(-1px)":"translateY(0)",transition:"transform 0.3s ease"}}),s.jsx("line",{x1:"34",y1:"6",x2:"34",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{transform:r?"translateY(-1px)":"translateY(0)",transition:"transform 0.3s ease 0.05s"}}),s.jsx("circle",{cx:"12",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.1s"}}),s.jsx("circle",{cx:"18",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.15s"}}),s.jsx("circle",{cx:"24",cy:"24",r:"1.5",fill:"white",style:{opacity:r?1:.4,transition:"opacity 0.3s ease 0.2s"}}),s.jsx("circle",{cx:"30",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.25s"}}),s.jsx("circle",{cx:"36",cy:"24",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.3s"}}),s.jsx("circle",{cx:"12",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.35s"}}),s.jsx("circle",{cx:"18",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.4s"}}),s.jsx("circle",{cx:"24",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.8:.3,transition:"opacity 0.3s ease 0.45s"}}),s.jsx("circle",{cx:"30",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.5s"}}),s.jsx("circle",{cx:"36",cy:"30",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.55s"}}),s.jsx("circle",{cx:"12",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.6s"}}),s.jsx("circle",{cx:"18",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.65s"}}),s.jsx("circle",{cx:"24",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.6:.2,transition:"opacity 0.3s ease 0.7s"}}),s.jsx("circle",{cx:"30",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.75s"}}),s.jsx("circle",{cx:"36",cy:"36",r:"1.5",fill:"white",style:{opacity:r?.4:.1,transition:"opacity 0.3s ease 0.8s"}}),s.jsx("rect",{x:"8",y:"20",width:"32",height:"22",fill:"rgba(255,255,255,0.05)",style:{opacity:r?1:0,transition:"opacity 0.3s ease"}})]})})}function V({className:e,style:t}){const[r,a]=n.useState(!1);return s.jsx("div",{className:`cursor-pointer flex items-center justify-center ${e}`,style:t,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:s.jsxs("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 overflow-visible",children:[s.jsx("rect",{x:"6",y:"6",width:"36",height:"36",rx:"3",stroke:"white",strokeWidth:"3",fill:"none",style:{transform:r?"scale(1.02)":"scale(1)",transformOrigin:"24px 24px",transition:"transform 0.3s ease"}}),s.jsx("rect",{x:"10",y:"10",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"none",style:{opacity:.6}}),s.jsx("line",{x1:"20",y1:"14",x2:"28",y2:"14",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{opacity:.6}}),s.jsxs("g",{style:{transform:r?"translateY(12px) scale(1.05)":"translateY(0) scale(1)",transformOrigin:"24px 24px",transition:"transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:[s.jsx("rect",{x:"10",y:"20",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"rgba(0,0,0,0.9)"}),s.jsx("line",{x1:"20",y1:"24",x2:"28",y2:"24",stroke:"white",strokeWidth:"3",strokeLinecap:"round"}),s.jsxs("g",{style:{opacity:r?1:0,transition:"opacity 0.3s ease 0.15s"},children:[s.jsx("rect",{x:"12",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.7"}),s.jsx("rect",{x:"17",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.5"}),s.jsx("rect",{x:"22",y:"22",width:"4",height:"4",rx:"0.5",fill:"white",opacity:"0.6"}),s.jsx("line",{x1:"13",y1:"23.5",x2:"15",y2:"23.5",stroke:"rgba(0,0,0,0.5)",strokeWidth:"0.5"}),s.jsx("line",{x1:"18",y1:"23.5",x2:"20",y2:"23.5",stroke:"rgba(0,0,0,0.5)",strokeWidth:"0.5"}),s.jsx("line",{x1:"23",y1:"23.5",x2:"25",y2:"23.5",stroke:"rgba(0,0,0,0.5)",strokeWidth:"0.5"})]})]}),s.jsx("rect",{x:"10",y:"30",width:"28",height:"8",rx:"1",stroke:"white",strokeWidth:"3",fill:"none",style:{opacity:.6}}),s.jsx("line",{x1:"20",y1:"34",x2:"28",y2:"34",stroke:"white",strokeWidth:"3",strokeLinecap:"round",style:{opacity:.6}}),s.jsx("rect",{x:"10",y:"28",width:"28",height:"4",fill:"white",style:{opacity:r?.2:0,transition:"opacity 0.3s ease"}}),s.jsx("rect",{x:"20",y:"8",width:"8",height:"2",rx:"1",fill:"white",style:{opacity:r?.8:.4,transition:"opacity 0.3s ease"}})]})})}function Y({user:e,isTyping:t,onBack:n,showBackButton:a,onVideoCall:l,onScheduleMeeting:i,onOpenDrawer:o}){return s.jsxs("div",{className:"h-14 lg:h-16 px-3 lg:px-4 flex items-center justify-between min-w-0",style:{borderBottom:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"#111111"},children:[s.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 min-w-0 flex-1",children:[a&&s.jsx("button",{onClick:n,className:"p-1.5 lg:p-2 -ml-1 lg:-ml-2 rounded-full hover:brightness-110 transition-colors lg:hidden",style:{color:"#64748B"},children:s.jsx(r,{className:"w-4 h-4 lg:w-5 lg:h-5"})}),s.jsx("div",{className:"relative flex-shrink-0",children:s.jsx("img",{src:e.is_admin?P:e.avatar_url||z,alt:e.name,className:"w-8 h-8 lg:w-10 lg:h-10 rounded-full object-cover default-avatar-shake",style:{backgroundColor:"#0f0f13"}})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h2",{className:"text-sm lg:text-base font-medium truncate",style:{color:"#F8FAFC"},children:e.name}),t&&s.jsx("p",{className:"text-[10px] lg:text-xs",style:{color:"#64748B"},children:"typing..."})]})]}),s.jsxs("div",{className:"flex items-center gap-1 lg:gap-2",children:[s.jsx("button",{onClick:l,className:"p-2.5 rounded-lg transition-colors","aria-label":"Video call",children:s.jsx(W,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"}})}),s.jsx("button",{onClick:i,className:"p-2.5 rounded-lg transition-colors","aria-label":"Schedule meeting",children:s.jsx(H,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"}})}),s.jsx("button",{onClick:o,className:"p-2.5 rounded-lg transition-colors","aria-label":"View details",children:s.jsx(V,{className:"w-5 h-5 lg:w-6 lg:h-6",style:{color:"#94A3B8"}})})]})]})}function G({isOpen:e,onClose:t,imageUrl:r}){return n.useEffect(()=>{const s=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow=""}},[e,t]),e?s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm animate-fade-in",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:t,children:[s.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[s.jsx("a",{href:r,download:!0,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},onClick:e=>e.stopPropagation(),children:s.jsx(x,{className:"w-5 h-5"})}),s.jsx("button",{onClick:t,className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:s.jsx(j,{className:"w-5 h-5"})})]}),s.jsx("img",{src:r,alt:"Full size preview",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg",onClick:e=>e.stopPropagation()})]}):null}const K=n.memo(function(){return n.useEffect(()=>{if(!document.getElementById("wave-hand-keyframes")){const e=document.createElement("style");e.id="wave-hand-keyframes",e.textContent="\n        @keyframes wave-hand {\n          0%, 100% {\n            transform: rotate(0deg);\n          }\n          10%, 30% {\n            transform: rotate(14deg);\n          }\n          20% {\n            transform: rotate(-8deg);\n          }\n          40%, 60% {\n            transform: rotate(0deg);\n          }\n          50% {\n            transform: rotate(10deg);\n          }\n          70% {\n            transform: rotate(0deg);\n          }\n          80% {\n            transform: rotate(-5deg);\n          }\n          90% {\n            transform: rotate(0deg);\n          }\n        }\n      ",document.head.appendChild(e)}},[]),s.jsx("span",{className:"inline-block",style:{display:"inline-block",transformOrigin:"70% 70%",animation:"wave-hand 1s ease-in-out infinite"},children:"ðŸ‘‹"})}),J=n.memo(function({message:e,isOwn:t,onReply:r,onScrollToMessage:a,senderName:l,onImageLoad:i}){const[o,c]=n.useState(!1),[d,u]=n.useState(!1),[x,h]=n.useState(!1),[p,g]=n.useState(!1);n.useEffect(()=>{if("image"===e.type&&e.image_url){const t=new Image;t.onload=()=>{g(!0),null==i||i(e.id,!0)},t.onerror=()=>{h(!0),null==i||i(e.id,!0)},t.src=e.image_url}else null==i||i(e.id,!0)},[e.id,e.type,e.image_url,i]);const f=e.reply_to_id&&(e.reply_to_sender_name||e.reply_to_content);return s.jsxs(s.Fragment,{children:[s.jsx("div",{id:`message-${e.id}`,className:`group flex ${t?"justify-end":"justify-start"} px-2 lg:px-4 py-0.5`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:s.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 max-w-[85%] lg:max-w-[70%] min-w-0 "+(t?"flex-row-reverse":"flex-row"),children:[s.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[f&&s.jsxs("button",{onClick:()=>{e.reply_to_id&&a&&a(e.reply_to_id)},className:"text-left px-2 py-1.5 rounded-lg border-l-2 transition-colors "+(t?"ml-auto":"mr-auto"),style:{backgroundColor:"#1a1a1e",borderColor:"#64748B",color:"#F8FAFC"},children:[s.jsx("p",{className:"text-[10px] font-medium",style:{color:"#64748B"},children:e.reply_to_sender_name}),s.jsx("p",{className:"text-[10px] line-clamp-1",style:{color:"#94A3B8"},children:e.reply_to_content||"Image"})]}),s.jsxs("div",{className:"relative rounded-2xl overflow-hidden transition-all duration-200 min-w-0 "+("image"!==e.type||e.content?"":"p-0"),style:t?{backgroundColor:"#F8FAFC",color:"#111111"}:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:["image"===e.type&&e.image_url&&s.jsx("div",{className:"relative "+(e.content?"px-4 pt-3":"p-0"),children:x?s.jsx("div",{className:"rounded-lg flex items-center justify-center "+(e.content?"mb-2":""),style:{width:"100%",maxWidth:"280px",height:"200px",backgroundColor:"#0f0f13"},children:s.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:"Failed to load image"})}):s.jsxs(s.Fragment,{children:[!p&&s.jsx("div",{className:"chat-image-placeholder rounded-lg "+(e.content?"mb-2":""),style:{width:"280px",height:"200px",backgroundColor:"rgba(75, 85, 99, 0.15)"}}),s.jsx("img",{src:e.image_url,alt:"Shared image",className:`rounded-lg w-full max-w-[280px] lg:max-w-[280px] max-h-[300px] object-cover cursor-pointer hover:opacity-90 transition-opacity ${e.content?"mb-2":""} ${p?"chat-image-loaded":""}`,style:{display:p?"block":"none",border:"none",outline:"none"},onClick:()=>u(!0),onError:()=>h(!0),onLoad:()=>g(!0)})]})}),e.content&&s.jsx("div",{className:"flex items-center min-h-[1.5rem] "+("image"===e.type&&e.image_url?"px-4 pb-3":"px-4 py-3"),children:s.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words w-full",children:e.content.split("ðŸ‘‹").map((e,t,n)=>t<n.length-1?s.jsxs("span",{children:[e,s.jsx(K,{})]},t):s.jsx("span",{children:e},t))})})]}),s.jsx("span",{className:"text-[10px] px-1 "+(t?"text-right":"text-left"),style:{color:"#94A3B8"},children:(y=e.created_at,new Date(y).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))})]}),s.jsxs("div",{className:"flex items-center gap-1 transition-opacity duration-200 "+(o?"opacity-100":"opacity-0"),children:[e.content&&s.jsx("button",{onClick:async()=>{if(e.content)try{await navigator.clipboard.writeText(e.content)}catch(t){}},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:s.jsx(m,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>{r&&r({id:e.id,senderName:l||"Unknown",content:e.content||("image"===e.type?"Image":"")})},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:s.jsx(v,{className:"w-3.5 h-3.5"})})]})]})}),"image"===e.type&&e.image_url&&s.jsx(G,{isOpen:d,onClose:()=>u(!1),imageUrl:e.image_url})]});var y}),X={sm:{container:"w-8 h-8"},md:{container:"w-10 h-10"},lg:{container:"w-12 h-12"}};function Z({src:e,name:t,size:r="md",isOnline:a,showOnlineIndicator:o=!1,isAdmin:c=!1}){const[d,u]=n.useState(!1),[m,x]=n.useState(!1),[h,p]=n.useState(null),g=n.useRef(null),f=c?P:e||"",y=f&&""!==f.trim();n.useEffect(()=>{if(!y)return void x(!0);const e=l(f);if(!e){i(f),u(!1),x(!1);const e=function(e,t,s){const n=new Image;return n.onload=t,n.onerror=s,n.src=e,n}(f,()=>u(!0),()=>x(!0));return g.current=e,()=>{g.current&&(g.current.onload=null,g.current.onerror=null)}}p(e),u(!0),i(f)},[f,y]);const v=h||f,w=y&&(d||h)&&!m,b=z;return s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsxs("div",{className:`${X[r].container} rounded-full flex items-center justify-center overflow-hidden relative`,children:[s.jsx("img",{src:b,alt:t,className:`${X[r].container} rounded-full object-cover absolute inset-0 default-avatar-shake`,style:{opacity:w?0:1,transition:"opacity 0.2s ease-in-out"}}),y&&s.jsx("img",{src:v,alt:t,className:`${X[r].container} rounded-full object-cover absolute inset-0`,style:{opacity:w?1:0,transition:w&&!h?"opacity 0.15s ease-in-out":"none"},onLoad:()=>{h||u(!0)},onError:()=>x(!0),loading:"eager",decoding:"async",fetchpriority:"high"})]}),o&&s.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 border-2 rounded-full z-10",style:{borderColor:"#111111",backgroundColor:a?"#10b981":"#64748B"}})]})}function Q({x:e,y:t,onClose:r,onPin:a,isPinned:l=!1}){const i=n.useRef(null);return n.useEffect(()=>{const e=e=>{i.current&&!i.current.contains(e.target)&&r()},t=e=>{"Escape"===e.key&&r()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[r]),n.useEffect(()=>{if(i.current){const s=i.current,n=s.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;n.right>r&&(s.style.left=e-n.width+"px"),n.bottom>a&&(s.style.top=t-n.height+"px")}},[e,t]),s.jsx("div",{ref:i,className:"fixed rounded-lg shadow-lg py-1 min-w-[200px] z-50",style:{left:e,top:t,backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:s.jsxs("button",{onClick:()=>{null==a||a(),r()},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:brightness-110 transition-colors",style:{color:"#F8FAFC"},children:[s.jsx(y,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:l?"Unpin":"Pin"})]})})}const ee=n.memo(function({user:e,conversation:t,isActive:r,onClick:a,onPin:l,unreadCount:i,currentUserId:o}){const c=void 0!==i?i:t.unread_count_customer,[d,u]=n.useState(null),m=t.last_message?(()=>{let e=t.last_message.replace(/\n/g," ").trim();return e.startsWith("Me: ")&&(e=e.substring(4).trim()),o&&t.last_message_sender_id===o?"Me: "+e:e})():"No messages yet";return s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:a,onContextMenu:e=>{e.preventDefault(),u({x:e.clientX,y:e.clientY})},className:"w-full flex items-center gap-2 lg:gap-3 px-3 lg:px-4 py-2 lg:py-3 transition-colors text-left "+(r?"":"hover:brightness-110"),style:r?{backgroundColor:"#0f0f13"}:{backgroundColor:"transparent"},children:[s.jsx(Z,{src:e.avatar_url,name:e.name,size:"lg",isAdmin:e.is_admin}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[s.jsx("span",{className:"text-sm lg:text-base font-medium truncate",style:{color:"#F8FAFC"},children:e.name}),s.jsx("span",{className:"text-[10px] lg:text-xs flex-shrink-0 ml-2",style:{color:"#64748B"},children:R(t.last_message_at)})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-xs lg:text-sm truncate pr-2",style:{color:"#94A3B8"},children:m}),c>0&&s.jsx("span",{className:"flex-shrink-0 min-w-[18px] lg:min-w-[20px] h-4 lg:h-5 px-1 lg:px-1.5 flex items-center justify-center text-[10px] lg:text-xs font-medium rounded-full",style:{backgroundColor:"#ef4444",color:"#FFFFFF"},children:c>99?"99+":c})]})]})]}),d&&s.jsx(Q,{x:d.x,y:d.y,onClose:()=>u(null),onPin:()=>{null==l||l(t.id,!t.is_pinned)},isPinned:t.is_pinned})]})});function te(){return s.jsx("div",{className:"flex items-center gap-1 px-4 py-2",children:s.jsxs("div",{className:"flex items-center gap-1 rounded-2xl px-4 py-3",style:{backgroundColor:"#1a1a1e"},children:[s.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"0ms"}}),s.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"150ms"}}),s.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"300ms"}})]})})}function se({title:e,isOpen:t,onToggle:n,children:r}){return s.jsxs("div",{style:{borderBottom:"1px solid #2a2a2a"},children:[s.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between px-4 py-3 hover:bg-white/5 transition-colors",children:[s.jsx("span",{className:"text-sm font-medium",style:{color:"#F8FAFC"},children:e}),t?s.jsx(o,{className:"w-4 h-4",style:{color:"#64748B"}}):s.jsx(u,{className:"w-4 h-4",style:{color:"#64748B"}})]}),s.jsx("div",{className:"overflow-hidden transition-all duration-300 ease-in-out",style:{maxHeight:t?"500px":"0"},children:s.jsx("div",{className:"px-4 pb-4",children:r})})]})}function ne({isOpen:e,onClose:t,user:r,activities:a=[],meetings:l=[],files:i=[],participants:o=[],onSearchMessages:c}){const[u,m]=n.useState({activity:!1,search:!1,meetings:!1,people:!1,files:!1,notes:!1}),[p,f]=n.useState(""),[y,v]=n.useState(""),b=n.useRef(null);n.useEffect(()=>{const s=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow=""}},[e,t]),n.useEffect(()=>{const e=localStorage.getItem(`chat_notes_${r.id}`);e&&v(e)},[r.id]);const k=e=>{m(t=>({...t,[e]:!t[e]}))},_=a.length>0?a:[{id:"1",type:"contract",title:"Contract signed",date:"2024-01-15"},{id:"2",type:"milestone",title:"First deliverable completed",date:"2024-01-20"},{id:"3",type:"payment",title:"Payment received",description:"$500",date:"2024-01-25"}],N=l.length>0?l:[{id:"1",title:"Kickoff call",date:"2024-01-10",summary:"Discussed project scope and timeline"},{id:"2",title:"Progress review",date:"2024-01-18",summary:"Reviewed first draft, minor revisions needed"}],C=i.length>0?i:[{id:"1",name:"Contract.pdf",type:"file",size:"245 KB",url:"#",date:"2024-01-15"},{id:"2",name:"Brand Guidelines",type:"link",url:"#",date:"2024-01-12"}],F=o.length>0?o:[{id:r.id,name:r.name,avatar_url:r.avatar_url,role:"Creator"}];return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 transition-opacity duration-300 "+(e?"opacity-100":"opacity-0 pointer-events-none"),onClick:t}),s.jsx("div",{className:"fixed top-0 right-0 z-50 h-full w-full sm:w-[360px] transform transition-transform duration-300 ease-in-out "+(e?"translate-x-0":"translate-x-full"),style:{backgroundColor:"#0a0a0a"},children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-4",style:{borderBottom:"1px solid #2a2a2a"},children:[s.jsx("h2",{className:"text-base font-semibold",style:{color:"#F8FAFC"},children:"Details"}),s.jsx("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-white/5 transition-colors","aria-label":"Close",children:s.jsx(j,{className:"w-5 h-5",style:{color:"#94A3B8"}})})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.3) transparent"},children:[s.jsxs("div",{className:"px-4 py-6 text-center",style:{borderBottom:"1px solid #2a2a2a"},children:[s.jsx("img",{src:r.is_admin?P:r.avatar_url||z,alt:r.name,className:"w-20 h-20 rounded-full object-cover mx-auto mb-3",style:{backgroundColor:"#0f0f13"}}),s.jsx("h3",{className:"text-lg font-semibold mb-1",style:{color:"#F8FAFC"},children:r.name}),s.jsx("p",{className:"text-sm mb-1",style:{color:"#64748B"},children:"Creator"}),s.jsx("p",{className:"text-xs mb-4",style:{color:"#64748B"},children:"PST (UTC-8)"}),s.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-white/10",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#3B82F6",border:"1px solid rgba(59, 130, 246, 0.3)"},children:"View Contract"})]}),s.jsx(se,{title:"Activity Timeline",isOpen:u.activity,onToggle:()=>k("activity"),children:s.jsx("div",{className:"space-y-3",children:_.map((e,t)=>s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:"payment"===e.type?"#22C55E":"milestone"===e.type?"#3B82F6":"#64748B"}}),t<_.length-1&&s.jsx("div",{className:"w-0.5 flex-1 mt-1",style:{backgroundColor:"#2a2a2a"}})]}),s.jsxs("div",{className:"flex-1 pb-3",children:[s.jsx("p",{className:"text-sm",style:{color:"#F8FAFC"},children:e.title}),e.description&&s.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:e.description}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"#64748B"},children:e.date})]})]},e.id))})}),s.jsx(se,{title:"Search Messages",isOpen:u.search,onToggle:()=>k("search"),children:s.jsxs("div",{className:"relative",children:[s.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"#64748B"}}),s.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&void(c&&p.trim()&&c(p)),placeholder:"Search in conversation...",className:"w-full pl-10 pr-4 py-2.5 rounded-lg text-sm focus:outline-none focus:ring-1",style:{backgroundColor:"#1a1a1a",border:"1px solid #2a2a2a",color:"#F8FAFC"}})]})}),s.jsx(se,{title:"Meeting Recaps",isOpen:u.meetings,onToggle:()=>k("meetings"),children:s.jsx("div",{className:"space-y-3",children:N.map(e=>s.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"#1a1a1a"},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(d,{className:"w-3.5 h-3.5",style:{color:"#64748B"}}),s.jsx("span",{className:"text-xs",style:{color:"#64748B"},children:e.date})]}),s.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"#F8FAFC"},children:e.title}),e.summary&&s.jsx("p",{className:"text-xs",style:{color:"#94A3B8"},children:e.summary})]},e.id))})}),s.jsx(se,{title:"People",isOpen:u.people,onToggle:()=>k("people"),children:s.jsx("div",{className:"space-y-2",children:F.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors",children:[s.jsx("img",{src:e.avatar_url||z,alt:e.name,className:"w-9 h-9 rounded-full object-cover",style:{backgroundColor:"#0f0f13"}}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",style:{color:"#F8FAFC"},children:e.name}),e.role&&s.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:e.role})]})]},e.id))})}),s.jsx(se,{title:"Files and Links",isOpen:u.files,onToggle:()=>k("files"),children:s.jsx("div",{className:"space-y-2",children:C.map(e=>s.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors",children:["file"===e.type?s.jsx(h,{className:"w-5 h-5",style:{color:"#64748B"}}):s.jsx(g,{className:"w-5 h-5",style:{color:"#64748B"}}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm truncate",style:{color:"#F8FAFC"},children:e.name}),s.jsxs("p",{className:"text-xs",style:{color:"#64748B"},children:[e.size?`${e.size} â€¢ `:"",e.date]})]}),"file"===e.type&&s.jsx(x,{className:"w-4 h-4 flex-shrink-0",style:{color:"#64748B"}})]},e.id))})}),s.jsxs(se,{title:"Personal Notepad",isOpen:u.notes,onToggle:()=>k("notes"),children:[s.jsx("textarea",{value:y,onChange:e=>{return t=e.target.value,v(t),b.current&&clearTimeout(b.current),void(b.current=setTimeout(()=>{localStorage.setItem(`chat_notes_${r.id}`,t)},500));var t},placeholder:"Add private notes about this conversation...",className:"w-full h-32 p-3 rounded-lg text-sm resize-none focus:outline-none focus:ring-1",style:{backgroundColor:"#1a1a1a",border:"1px solid #2a2a2a",color:"#F8FAFC"}}),s.jsx("p",{className:"text-xs mt-2",style:{color:"#64748B"},children:"Notes are saved automatically and only visible to you."})]})]})]})})]})}function re(e,t){let s=null;return function(...n){s&&clearTimeout(s),s=setTimeout(()=>{s=null,e(...n)},t)}}export{c as A,m as C,z as D,P as E,g as L,f as M,w as S,ee as U,j as X,B as a,E as b,I as c,re as d,u as e,d as f,M as g,A as h,b as i,T as j,S as u};

import{c as e}from"./createLucideIcon-DApH4y_Q.js";import{j as t}from"./spline-DN92G9fQ.js";import{r as n}from"./react-vendor-C5CBPnGl.js";import{A as s}from"./arrow-left-D6ZoFILw.js";import{X as a,C as r}from"./x-CKfmtFfh.js";import{s as o}from"./index-r4cNR4_R.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=e("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),i=e("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),c=e("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),d=e("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),u=e("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),m=e("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),g=e("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),f=e("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function p(e){const[t,s]=n.useState([]),[a,r]=n.useState(!0);return n.useEffect(()=>{if(!e)return s([]),void r(!1);const t=async()=>{const{data:t,error:n}=await o.from("conversations").select("\n          *,\n          admin:profiles!conversations_admin_id_fkey(*)\n        ").eq("customer_id",e).order("last_message_at",{ascending:!1});!n&&t&&s(t),r(!1)};t();const n=o.channel(`customer-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`customer_id=eq.${e}`},()=>{t()}).subscribe();return()=>{n.unsubscribe()}},[e]),{conversations:t,loading:a}}function x(e){const[t,s]=n.useState(null),[a,r]=n.useState(!0);return n.useEffect(()=>{(async()=>{const{data:t,error:n}=await o.from("profiles").select("*").eq("id",e).maybeSingle();!n&&t&&s(t),r(!1)})();const t=o.channel(`profile:${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${e}`},e=>{s(e.new)}).subscribe();return()=>{t.unsubscribe()}},[e]),{profile:t,loading:a}}function h(e){n.useEffect(()=>{const t=async t=>{await o.from("profiles").update({is_online:t,last_seen:(new Date).toISOString()}).eq("id",e)};t(!0);const n=()=>{t(!document.hidden)},s=()=>{t(!1)};return document.addEventListener("visibilitychange",n),window.addEventListener("beforeunload",s),()=>{document.removeEventListener("visibilitychange",n),window.removeEventListener("beforeunload",s),t(!1)}},[e])}async function y(){try{const{data:e,error:t}=await o.from("profiles").select("id").eq("is_admin",!0).limit(1).maybeSingle();return t?null:e?e.id:null}catch(e){return null}}async function b(e){var t;try{const n=await y();if(!n)return null;const{data:s,error:a}=await o.from("conversations").select("*").eq("customer_id",e).eq("admin_id",n).maybeSingle();if(a&&"PGRST116"!==a.code)return null;if(s){const{data:e,error:t}=await o.from("profiles").select("*").eq("id",n).single();return t?null:e?{...s,admin:e}:null}const{data:r,error:l}=await o.from("conversations").insert({customer_id:e,admin_id:n,last_message:"",unread_count_admin:0,unread_count_customer:0}).select("*").single();if(l)return null;const{data:i}=await o.from("users").select("first_name").eq("id",e).maybeSingle(),c=(null==(t=null==i?void 0:i.first_name)?void 0:t.trim())||"",d=`Hi${c?` ${c},`:""} welcome to Elevate! ðŸ‘‹\n\nIf you have any questions, feel free to ask.\n\nHave suggestions or feedback? You can submit them here. We review everything and are always working to give you the best experience on Elevate.`,{error:u}=await o.from("messages").insert({conversation_id:r.id,sender_id:n,type:"text",content:d,status:"sent"});if(u);else{const e=d.split("\n")[0];await o.from("conversations").update({last_message:e,last_message_at:(new Date).toISOString(),last_message_sender_id:n,unread_count_customer:1}).eq("id",r.id)}const{data:m,error:g}=await o.from("profiles").select("*").eq("id",n).single();if(g)return null;if(m&&r){return{...r,admin:m}}return null}catch(n){return null}}function v(e){const[t,s]=n.useState([]),[a,r]=n.useState(!0);return n.useEffect(()=>{const t=async()=>{const{data:t,error:n}=await o.from("conversations").select("*").eq("admin_id",e);if(n)return void r(!1);if(!t||0===t.length)return s([]),void r(!1);const a=[...new Set(t.map(e=>e.customer_id))],l=t.map(e=>e.id),{data:i,error:c}=await o.from("profiles").select("*").in("id",a);if(c)return void r(!1);const{data:d,error:u}=await o.from("messages").select("conversation_id, created_at, sender_id").in("conversation_id",l).order("created_at",{ascending:!1}),m=new Map;if(d)for(const e of d){const n=t.find(t=>t.id===e.conversation_id);n&&e.sender_id===n.customer_id&&(m.has(e.conversation_id)||m.set(e.conversation_id,e.created_at))}const g=new Map((i||[]).map(e=>[e.id,e])),f=t.map(e=>({...e,customer:g.get(e.customer_id)||null,last_customer_message_at:m.get(e.id)||e.last_message_at})).filter(e=>null!==e.customer);f.sort((e,t)=>{const n=m.has(e.id),s=m.has(t.id);if(n&&!s)return-1;if(!n&&s)return 1;const a=e.last_customer_message_at?new Date(e.last_customer_message_at).getTime():e.last_message_at?new Date(e.last_message_at).getTime():0;return(t.last_customer_message_at?new Date(t.last_customer_message_at).getTime():t.last_message_at?new Date(t.last_message_at).getTime():0)-a}),s(f),r(!1)};t();const n=o.channel(`admin-conversations:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`admin_id=eq.${e}`},()=>{t()}).on("postgres_changes",{event:"*",schema:"public",table:"messages"},()=>{t()}).subscribe();return()=>{n.unsubscribe()}},[e]),{conversations:t,loading:a}}function w(e){const t=new Date(e),n=new Date,s=n.getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?"Today":1===a?"Yesterday":a<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==n.getFullYear()?"numeric":void 0})}function _(e){const t=new Date(e),n=(new Date).getTime()-t.getTime(),s=Math.floor(n/864e5);return 0===s?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):1===s?"Yesterday":s<7?t.toLocaleDateString("en-US",{weekday:"short"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const j=n.memo(function({conversation:e,otherUser:s,currentUserId:a,getSenderName:r}){const{messages:l,loading:i,otherUserTyping:c,sendMessage:d,setTyping:u,markMessagesAsSeen:m}=function({conversationId:e,currentUserId:t}){const[s,a]=n.useState([]),[r,l]=n.useState(!0),[i,c]=n.useState(!1),d=n.useRef(null),u=n.useCallback(async()=>{try{const{data:t,error:n}=await o.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(n)return;t&&a(t)}catch(t){}finally{l(!1)}},[e]);return n.useEffect(()=>{u();const n=o.channel(`messages:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},e=>{const t=e.new;a(e=>e.some(e=>e.id===t.id)?e:[...e,t])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},e=>{const t=e.new;a(e=>e.map(e=>e.id===t.id?t:e))}).subscribe(),s=o.channel(`typing:${e}`).on("broadcast",{event:"typing"},({payload:e})=>{e.userId!==t&&c(e.isTyping)}).subscribe();return d.current=s,()=>{n.unsubscribe(),s.unsubscribe()}},[e,t,u]),{messages:s,loading:r,otherUserTyping:i,sendMessage:n.useCallback(async(n,s,a)=>{const r=s?"image":"text",{data:l,error:i}=await o.from("messages").insert({conversation_id:e,sender_id:t,type:r,content:n||"",image_url:s||"",status:"sent",reply_to_id:(null==a?void 0:a.id)||null,reply_to_sender_name:(null==a?void 0:a.senderName)||"",reply_to_content:(null==a?void 0:a.content)||""}).select().single();if(i)return{data:null,error:i};if(l){const{data:s}=await o.from("conversations").select("customer_id, admin_id, unread_count_admin, unread_count_customer").eq("id",e).single();if(s){const a=s.customer_id===t;let r=n||"Sent an image";"Sent an image"!==r&&(r=r.replace(/\n/g," ").trim(),r.startsWith("Me: ")&&(r=r.substring(4).trim()),r.length>80&&(r=r.substring(0,80)+"..."));const l={last_message:r,last_message_at:(new Date).toISOString(),last_message_sender_id:t};a?l.unread_count_admin=(s.unread_count_admin||0)+1:l.unread_count_customer=(s.unread_count_customer||0)+1;const{error:i}=await o.from("conversations").update(l).eq("id",e)}}return{data:l,error:null}},[e,t]),setTyping:n.useCallback(e=>{var n;null==(n=d.current)||n.send({type:"broadcast",event:"typing",payload:{userId:t,isTyping:e}})},[t]),markMessagesAsSeen:n.useCallback(async()=>{const{data:n}=await o.from("conversations").select("customer_id, admin_id").eq("id",e).single();if(n){const s=n.customer_id===t;await o.from("messages").update({status:"seen"}).eq("conversation_id",e).neq("sender_id",t).neq("status","seen");const a={};s?a.unread_count_customer=0:a.unread_count_admin=0;const{error:r}=await o.from("conversations").update(a).eq("id",e)}},[e,t])}}({conversationId:e.id,currentUserId:a}),{uploadImage:g,uploading:f}=function(){const[e,t]=n.useState(!1);return{uploadImage:async e=>{var n;t(!0);try{const t=new FormData;t.append("image",e);const s=await fetch("https://api.imgbb.com/1/upload?key=a7c74e4a5e2a5afe2a3c8f4b1d9e6f2a",{method:"POST",body:t});if(s.ok){const e=await s.json();if(null==(n=e.data)?void 0:n.url)return e.data.url}const a=new FileReader;return new Promise((t,n)=>{a.onerror=()=>{n(new Error("Failed to read image"))},a.onloadend=()=>{t(a.result)},a.readAsDataURL(e)})}catch(s){const t=new FileReader;return new Promise((n,s)=>{t.onerror=()=>{s(new Error("Failed to read image"))},t.onloadend=()=>{n(t.result)},t.readAsDataURL(e)})}finally{t(!1)}},uploading:e}}(),p=n.useRef(null),[x,h]=n.useState(null),y=n.useCallback((e="smooth")=>{p.current&&p.current.scrollIntoView({behavior:e})},[]);n.useEffect(()=>{i||y("instant")},[i,e.id,y]),n.useEffect(()=>{l.length>0&&y()},[l.length,y]),n.useEffect(()=>{m()},[l,m]);const b=n.useCallback(e=>{h(e)},[]),v=n.useCallback(()=>{h(null)},[]),_=n.useCallback(e=>{const t=document.getElementById(`message-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-neutral-700/30"),setTimeout(()=>{t.classList.remove("bg-neutral-700/30")},1500))},[]);return i?t.jsx("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"#111111"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"0ms"}}),t.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"150ms"}}),t.jsx("div",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"300ms"}})]})}):t.jsxs("div",{className:"flex-1 flex flex-col min-h-0 min-w-0",style:{backgroundColor:"#111111"},children:[t.jsx(E,{user:s,isTyping:c}),t.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",style:{backgroundColor:"#111111",scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.3) transparent"},children:t.jsxs("div",{className:"py-4 min-h-full flex flex-col justify-end",children:[0===l.length?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center px-6",children:[t.jsx("div",{className:"w-20 h-20 mx-auto mb-5 rounded-2xl flex items-center justify-center",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.1)"},children:t.jsx("svg",{className:"w-10 h-10",style:{color:"#64748B"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),t.jsx("p",{className:"text-sm font-medium",style:{color:"#94A3B8"},children:"No messages yet"}),t.jsx("p",{className:"text-xs mt-1",style:{color:"#64748B"},children:"Start the conversation by sending a message"})]})}):t.jsx("div",{className:"space-y-1 px-2",children:l.map((e,n)=>{const s=n>0?l[n-1]:null,o=new Date(e.created_at),i=s?new Date(s.created_at):null,c=!(i&&(d=o,u=i,d.getFullYear()===u.getFullYear()&&d.getMonth()===u.getMonth()&&d.getDate()===u.getDate()));var d,u;return t.jsxs("div",{children:[c&&t.jsx("div",{className:"flex items-center justify-center py-5",children:t.jsx("div",{className:"px-3 py-1.5 rounded-lg",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.15)"},children:t.jsx("span",{className:"text-xs font-medium",style:{color:"#94A3B8"},children:w(e.created_at)})})}),t.jsx(B,{message:e,isOwn:e.sender_id===a,onReply:b,onScrollToMessage:_,senderName:r(e.sender_id)})]},e.id)})}),c&&t.jsx(U,{}),t.jsx("div",{ref:p})]})}),t.jsx(F,{onSendMessage:async(e,t,n)=>{h(null);try{let s;if(t&&(s=await g(t)||void 0,!s))throw new Error("Failed to upload image");const a=await d(e,s,n);if(null==a?void 0:a.error)throw a.error}catch(s){}},onTyping:u,disabled:f,replyTo:x,onCancelReply:v})]})});function k({file:e,onRemove:s}){const[r,o]=n.useState("");return n.useEffect(()=>{const t=URL.createObjectURL(e);return o(t),()=>{URL.revokeObjectURL(t)}},[e]),t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:r,alt:"Upload preview",className:"w-20 h-20 object-cover rounded-lg",style:{border:"1px solid rgba(75, 85, 99, 0.2)"}}),t.jsx("button",{onClick:s,className:"absolute -top-2 -right-2 p-1 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:t.jsx(a,{className:"w-3.5 h-3.5",style:{color:"#F8FAFC"}})})]})}function N({replyTo:e,onCancel:n}){const s=e.content.length>80?e.content.substring(0,80)+"...":e.content;return t.jsx("div",{className:"animate-fade-in",children:t.jsxs("div",{className:"flex items-start gap-3 px-3 py-2 rounded-lg border-l-2",style:{backgroundColor:"#1a1a1e",borderColor:"#64748B"},children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-xs font-medium",style:{color:"#F8FAFC"},children:["Replying to ",e.senderName]}),t.jsx("p",{className:"text-xs truncate mt-0.5",style:{color:"#94A3B8"},children:s||"Image"})]}),t.jsx("button",{onClick:n,className:"shrink-0 p-1 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(a,{className:"w-4 h-4"})})]})})}const C=10485760,S=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];function F({onSendMessage:e,onTyping:s,disabled:a,replyTo:r,onCancelReply:o}){const[i,d]=n.useState(""),[u,m]=n.useState(null),g=n.useRef(null),p=n.useRef(null),x=n.useRef(null);n.useEffect(()=>{const e=p.current;if(e){e.style.height="36px";const t=e.scrollHeight;t>36&&(e.style.height=`${Math.min(t,150)}px`)}},[i]),n.useEffect(()=>{r&&p.current&&p.current.focus()},[r]);const h=()=>{!i.trim()&&!u||a||(e(i.trim(),u||void 0,r||void 0),d(""),m(null),s(!1),x.current&&clearTimeout(x.current))},y=n.useCallback(e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];n&&S.includes(n.type)?(n.size>C||m(n),e.target.value=""):e.target.value=""},[]),b=i.trim()||u;return t.jsx("div",{className:"px-4 py-6",style:{borderTop:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"#111111"},children:t.jsxs("div",{className:"max-w-4xl mx-auto space-y-3",children:[r&&o&&t.jsx(N,{replyTo:r,onCancel:o}),u&&t.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-3",style:{backgroundColor:"rgba(26, 26, 30, 0.5)"},children:[t.jsx(k,{file:u,onRemove:()=>m(null)}),u.size>C&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"#ef4444"},children:[t.jsx(l,{className:"w-4 h-4"}),t.jsx("span",{children:"File too large"})]})]}),t.jsx("form",{onSubmit:e=>{e.preventDefault(),h()},className:"relative",children:t.jsxs("div",{className:"relative rounded-2xl flex items-center transition-all",style:{border:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"#1a1a1e"},children:[t.jsx("input",{type:"file",ref:g,onChange:y,accept:"image/*",className:"hidden"}),t.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=g.current)?void 0:e.click()},disabled:a,className:"flex-shrink-0 ml-3 h-9 w-9 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",style:{color:"#64748B"},children:t.jsx(c,{className:"h-5 w-5"})}),t.jsx("textarea",{ref:p,value:i,onChange:e=>{d(e.target.value),s(!0),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{s(!1)},2e3)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())},placeholder:"Send a message...",disabled:a,rows:1,maxLength:5e3,"aria-label":"Message input",className:"flex-1 rounded-2xl px-3 py-2.5 text-sm leading-5 focus:outline-none resize-none overflow-y-auto disabled:opacity-50 disabled:cursor-not-allowed placeholder:text-neutral-500",style:{minHeight:"36px",maxHeight:"150px",color:"#F8FAFC",backgroundColor:"transparent"}}),t.jsx("button",{type:"submit",disabled:!b||a,className:"flex-shrink-0 mr-1 h-9 w-9 rounded-full transition-all flex items-center justify-center self-center disabled:opacity-50 disabled:cursor-not-allowed "+(b?"hover:brightness-110 active:scale-95":"cursor-not-allowed"),style:b?{backgroundColor:"#F8FAFC",color:"#111111"}:{backgroundColor:"transparent",color:"#64748B"},children:t.jsx(f,{className:"h-4 w-4"})})]})})]})})}function E({user:e,isTyping:n,onBack:a,showBackButton:r}){return t.jsx("div",{className:"h-16 px-4 flex items-center justify-between min-w-0",style:{borderBottom:"1px solid rgba(75, 85, 99, 0.2)",backgroundColor:"#1a1a1e"},children:t.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r&&t.jsx("button",{onClick:a,className:"p-2 -ml-2 rounded-full hover:brightness-110 transition-colors lg:hidden",style:{color:"#64748B"},children:t.jsx(s,{className:"w-5 h-5"})}),t.jsx("div",{className:"relative flex-shrink-0",children:t.jsx("img",{src:e.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name)}&background=333&color=fff`,alt:e.name,className:"w-10 h-10 rounded-full object-cover",style:{backgroundColor:"#0f0f13"}})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h2",{className:"font-medium truncate",style:{color:"#F8FAFC"},children:e.name}),n&&t.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:"typing..."})]})]})})}function T({isOpen:e,onClose:s,imageUrl:r}){return n.useEffect(()=>{const t=e=>{"Escape"===e.key&&s()};return e&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[e,s]),e?t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm animate-fade-in",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:s,children:[t.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[t.jsx("a",{href:r,download:!0,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},onClick:e=>e.stopPropagation(),children:t.jsx(i,{className:"w-5 h-5"})}),t.jsx("button",{onClick:s,className:"p-2 rounded-full transition-colors",style:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:t.jsx(a,{className:"w-5 h-5"})})]}),t.jsx("img",{src:r,alt:"Full size preview",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-lg",onClick:e=>e.stopPropagation()})]}):null}const D=n.memo(function(){return n.useEffect(()=>{if(!document.getElementById("wave-hand-keyframes")){const e=document.createElement("style");e.id="wave-hand-keyframes",e.textContent="\n        @keyframes wave-hand {\n          0%, 100% {\n            transform: rotate(0deg);\n          }\n          10%, 30% {\n            transform: rotate(14deg);\n          }\n          20% {\n            transform: rotate(-8deg);\n          }\n          40%, 60% {\n            transform: rotate(0deg);\n          }\n          50% {\n            transform: rotate(10deg);\n          }\n          70% {\n            transform: rotate(0deg);\n          }\n          80% {\n            transform: rotate(-5deg);\n          }\n          90% {\n            transform: rotate(0deg);\n          }\n        }\n      ",document.head.appendChild(e)}},[]),t.jsx("span",{className:"inline-block",style:{display:"inline-block",transformOrigin:"70% 70%",animation:"wave-hand 1s ease-in-out infinite"},children:"ðŸ‘‹"})}),B=n.memo(function({message:e,isOwn:s,onReply:a,onScrollToMessage:o,senderName:l}){const[i,c]=n.useState(!1),[d,u]=n.useState(!1),[g,f]=n.useState(!1),p=e.reply_to_id&&(e.reply_to_sender_name||e.reply_to_content);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:`message-${e.id}`,className:`group flex ${s?"justify-end":"justify-start"} px-4 py-0.5`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:t.jsxs("div",{className:"flex items-center gap-2 max-w-[70%] min-w-0 "+(s?"flex-row-reverse":"flex-row"),children:[t.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[p&&t.jsxs("button",{onClick:()=>{e.reply_to_id&&o&&o(e.reply_to_id)},className:"text-left px-2 py-1.5 rounded-lg border-l-2 transition-colors "+(s?"ml-auto":"mr-auto"),style:{backgroundColor:"#1a1a1e",borderColor:"#64748B",color:"#F8FAFC"},children:[t.jsx("p",{className:"text-[10px] font-medium",style:{color:"#64748B"},children:e.reply_to_sender_name}),t.jsx("p",{className:"text-[10px] line-clamp-1",style:{color:"#94A3B8"},children:e.reply_to_content||"Image"})]}),t.jsxs("div",{className:"relative rounded-2xl overflow-hidden transition-all duration-200 min-w-0 "+("image"!==e.type||e.content?"":"p-1"),style:s?{backgroundColor:"#F8FAFC",color:"#111111"}:{backgroundColor:"#1a1a1e",color:"#F8FAFC"},children:["image"===e.type&&e.image_url&&t.jsx("div",{className:"relative "+(e.content?"px-4 pt-3":"p-1"),children:g?t.jsx("div",{className:"rounded-lg flex items-center justify-center "+(e.content?"mb-2":""),style:{width:"280px",height:"200px",backgroundColor:"#0f0f13"},children:t.jsx("p",{className:"text-xs",style:{color:"#64748B"},children:"Failed to load image"})}):t.jsx("img",{src:e.image_url,alt:"Shared image",className:"rounded-lg max-w-[280px] max-h-[300px] object-cover cursor-pointer hover:opacity-90 transition-opacity "+(e.content?"mb-2":""),onClick:()=>u(!0),onError:()=>f(!0),loading:"lazy"})}),e.content&&t.jsx("div",{className:"flex items-center min-h-[1.5rem] "+("image"===e.type&&e.image_url?"px-4 pb-3":"px-4 py-3"),children:t.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words w-full",children:e.content.split("ðŸ‘‹").map((e,n,s)=>n<s.length-1?t.jsxs("span",{children:[e,t.jsx(D,{})]},n):t.jsx("span",{children:e},n))})})]}),t.jsx("span",{className:"text-[10px] px-1 "+(s?"text-right":"text-left"),style:{color:"#94A3B8"},children:(x=e.created_at,new Date(x).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))})]}),t.jsxs("div",{className:"flex items-center gap-1 transition-opacity duration-200 "+(i?"opacity-100":"opacity-0"),children:[e.content&&t.jsx("button",{onClick:async()=>{if(e.content)try{await navigator.clipboard.writeText(e.content)}catch(t){}},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(r,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>{a&&a({id:e.id,senderName:l||"Unknown",content:e.content||("image"===e.type?"Image":"")})},className:"p-1.5 rounded-full hover:brightness-110 transition-colors",style:{color:"#64748B"},children:t.jsx(m,{className:"w-3.5 h-3.5"})})]})]})}),"image"===e.type&&e.image_url&&t.jsx(T,{isOpen:d,onClose:()=>u(!1),imageUrl:e.image_url})]});var x}),M={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12"};function q({src:e,name:n,size:s="md",isOnline:a,showOnlineIndicator:r=!1}){return t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx("img",{src:e||`https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=333&color=fff`,alt:n,className:`${M[s]} rounded-full object-cover`,style:{backgroundColor:"#1a1a1e"}}),r&&t.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 border-2 rounded-full",style:{borderColor:"#111111",backgroundColor:a?"#10b981":"#64748B"}})]})}function L({x:e,y:s,onClose:a,onPin:r,isPinned:o=!1}){const l=n.useRef(null);return n.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&a()},t=e=>{"Escape"===e.key&&a()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[a]),n.useEffect(()=>{if(l.current){const t=l.current,n=t.getBoundingClientRect(),a=window.innerWidth,r=window.innerHeight;n.right>a&&(t.style.left=e-n.width+"px"),n.bottom>r&&(t.style.top=s-n.height+"px")}},[e,s]),t.jsx("div",{ref:l,className:"fixed rounded-lg shadow-lg py-1 min-w-[200px] z-50",style:{left:e,top:s,backgroundColor:"#1a1a1e",border:"1px solid rgba(75, 85, 99, 0.2)"},children:t.jsxs("button",{onClick:()=>{null==r||r(),a()},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:brightness-110 transition-colors",style:{color:"#F8FAFC"},children:[t.jsx(u,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:o?"Unpin":"Pin"})]})})}const A=n.memo(function({user:e,conversation:s,isActive:a,onClick:r,onPin:o,unreadCount:l,currentUserId:i}){const c=void 0!==l?l:s.unread_count_customer,[d,u]=n.useState(null),m=s.last_message?(()=>{let e=s.last_message.replace(/\n/g," ").trim();return e.startsWith("Me: ")&&(e=e.substring(4).trim()),i&&s.last_message_sender_id===i?"Me: "+e:e})():"No messages yet";return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:r,onContextMenu:e=>{e.preventDefault(),u({x:e.clientX,y:e.clientY})},className:"w-full flex items-center gap-3 px-4 py-3 transition-colors text-left "+(a?"":"hover:brightness-110"),style:a?{backgroundColor:"#0f0f13"}:{backgroundColor:"transparent"},children:[t.jsx(q,{src:e.avatar_url,name:e.name,size:"lg"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[t.jsx("span",{className:"font-medium truncate",style:{color:"#F8FAFC"},children:e.name}),t.jsx("span",{className:"text-xs flex-shrink-0 ml-2",style:{color:"#64748B"},children:_(s.last_message_at)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm truncate pr-2",style:{color:"#94A3B8"},children:m}),c>0&&t.jsx("span",{className:"flex-shrink-0 min-w-[20px] h-5 px-1.5 flex items-center justify-center text-xs font-medium rounded-full",style:{backgroundColor:"#ef4444",color:"#FFFFFF"},children:c>99?"99+":c})]})]})]}),d&&t.jsx(L,{x:d.x,y:d.y,onClose:()=>u(null),onPin:()=>{null==o||o(s.id,!s.is_pinned)},isPinned:s.is_pinned})]})});function U(){return t.jsx("div",{className:"flex items-center gap-1 px-4 py-2",children:t.jsxs("div",{className:"flex items-center gap-1 rounded-2xl px-4 py-3",style:{backgroundColor:"#1a1a1e"},children:[t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"0ms"}}),t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"150ms"}}),t.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"#64748B",animationDelay:"300ms"}})]})})}function I(e,t){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>{n=null,e(...s)},t)}}export{j as C,d as M,g as S,A as U,x as a,h as b,v as c,I as d,y as e,b as g,p as u};
